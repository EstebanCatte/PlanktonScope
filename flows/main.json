[
    {
        "id": "eaae323a.31b3",
        "type": "tab",
        "label": "Home",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b771c342.49603",
        "type": "tab",
        "label": "Sample",
        "disabled": false,
        "info": ""
    },
    {
        "id": "bccd1f23.87219",
        "type": "tab",
        "label": "Optic Configuration",
        "disabled": false,
        "info": ""
    },
    {
        "id": "baa1e3d9.cb29d",
        "type": "tab",
        "label": "Fluidic Acquisition",
        "disabled": false,
        "info": ""
    },
    {
        "id": "cb95299c.2817c8",
        "type": "tab",
        "label": "Segmentation",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c1660bc.e7ff7f8",
        "type": "tab",
        "label": "Gallery",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1371dec5.76e671",
        "type": "tab",
        "label": "Settings",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9daf9e2b.019fc",
        "type": "tab",
        "label": "Administration",
        "disabled": false,
        "info": ""
    },
    {
        "id": "f21ba04.c26266",
        "type": "tab",
        "label": "WIFI Management",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9a22e67a.378818",
        "type": "tab",
        "label": "MQTT Receive",
        "disabled": false,
        "info": ""
    },
    {
        "id": "1c24ad9c.bebec2",
        "type": "subflow",
        "name": "Config",
        "info": "An input to this subflow will get the configuration to be saved to disk.\n\nOn startup, this node outputs the loaded configuration",
        "category": "",
        "in": [
            {
                "x": 500,
                "y": 860,
                "wires": [
                    {
                        "id": "752a925a.2d11b4"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1220,
                "y": 300,
                "wires": [
                    {
                        "id": "ad541674.4791c8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "833bc5bb.217ba8",
        "type": "ui_group",
        "z": "",
        "name": "Preview",
        "tab": "181bb236.1e94be",
        "order": 1,
        "disp": true,
        "width": 18,
        "collapse": false
    },
    {
        "id": "3a6bb13f.c9703e",
        "type": "ui_tab",
        "name": "Home",
        "icon": "home",
        "order": 1,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "181bb236.1e94be",
        "type": "ui_tab",
        "name": "Optic Configuration",
        "icon": "fa-eye",
        "order": 3,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "c9194f02.9d5e9",
        "type": "ui_tab",
        "name": "Fluidic Acquisition",
        "icon": "fa-flask",
        "order": 4,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "8d16beb8.9b3fb",
        "type": "ui_tab",
        "name": "Segmentation",
        "icon": "fa-crop",
        "order": 5,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "d9cd733b.ab73d",
        "type": "ui_tab",
        "z": "",
        "name": "System Monitoring",
        "icon": "fa-cogs",
        "order": 7,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "4248342d.e55fac",
        "type": "ui_group",
        "name": "Optic Characterization",
        "tab": "181bb236.1e94be",
        "order": 2,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "858a0e3c.987fe",
        "type": "ui_group",
        "name": "Preview",
        "tab": "c9194f02.9d5e9",
        "order": 1,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "64903b47.4034e4",
        "type": "ui_group",
        "z": "",
        "name": "Navigation",
        "tab": "8d16beb8.9b3fb",
        "order": 3,
        "disp": false,
        "width": "6",
        "collapse": false
    },
    {
        "id": "3da7da8f.179606",
        "type": "ui_group",
        "name": "Processor",
        "tab": "d9cd733b.ab73d",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "cc8bc4eb.651868",
        "type": "ui_base",
        "z": "",
        "theme": {
            "name": "theme-dark",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#5900ce",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#097479",
                    "value": "#097479",
                    "edited": true
                },
                "page-titlebar-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#111111",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#0eb8c0",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#555555",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#333333",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#eeeeee",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#097479",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#333333",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "PlanktosScope",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 55,
                "sy": 55,
                "gx": 5,
                "gy": 5,
                "cx": 5,
                "cy": 5,
                "px": 5,
                "py": 5
            }
        }
    },
    {
        "id": "36739a35.7cce36",
        "type": "ui_tab",
        "z": "",
        "name": "Gallery",
        "icon": "fa-file-image-o",
        "order": 6,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "c0ebfc57.42527",
        "type": "ui_group",
        "z": "",
        "name": "Group 1",
        "tab": "36739a35.7cce36",
        "order": 1,
        "disp": false,
        "width": "24",
        "collapse": false
    },
    {
        "id": "737ec584.2eea2c",
        "type": "ui_tab",
        "z": "",
        "name": "Sample",
        "icon": "fa-eyedropper",
        "order": 2,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "6f97e7ae.270c48",
        "type": "ui_group",
        "name": "Group 1",
        "tab": "3a6bb13f.c9703e",
        "order": 1,
        "disp": false,
        "width": "4",
        "collapse": false
    },
    {
        "id": "3e1ba03d.f01d8",
        "type": "ui_group",
        "name": "Sample Identification",
        "tab": "737ec584.2eea2c",
        "order": 1,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "4e0cd5ea.17e59c",
        "type": "ui_group",
        "name": "Group 2",
        "tab": "3a6bb13f.c9703e",
        "order": 2,
        "disp": false,
        "width": "4",
        "collapse": false
    },
    {
        "id": "ef590206.24f6",
        "type": "ui_group",
        "name": "Group 3",
        "tab": "3a6bb13f.c9703e",
        "order": 3,
        "disp": false,
        "width": "4",
        "collapse": false
    },
    {
        "id": "ae8f6620.073358",
        "type": "ui_group",
        "name": "Group 4",
        "tab": "3a6bb13f.c9703e",
        "order": 4,
        "disp": false,
        "width": "4",
        "collapse": false
    },
    {
        "id": "196518b2.4d53b7",
        "type": "ui_group",
        "z": "",
        "name": "Group 5",
        "tab": "3a6bb13f.c9703e",
        "order": 5,
        "disp": false,
        "width": "4",
        "collapse": false
    },
    {
        "id": "777a7c33.fcd804",
        "type": "ui_group",
        "name": "Group 6",
        "tab": "3a6bb13f.c9703e",
        "order": 6,
        "disp": false,
        "width": "4",
        "collapse": false
    },
    {
        "id": "cef1e703.bcf3c8",
        "type": "ui_group",
        "z": "",
        "name": "Sample Location",
        "tab": "737ec584.2eea2c",
        "order": 2,
        "disp": true,
        "width": "10",
        "collapse": false
    },
    {
        "id": "5517c651.b2f668",
        "type": "ui_group",
        "name": "Validation",
        "tab": "737ec584.2eea2c",
        "order": 4,
        "disp": false,
        "width": 10,
        "collapse": false
    },
    {
        "id": "fbd92986.1028c8",
        "type": "ui_group",
        "name": "Focus Adjustment",
        "tab": "181bb236.1e94be",
        "order": 4,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "707d9797.c8e798",
        "type": "ui_group",
        "name": "Fluidic Manual Manipulation",
        "tab": "181bb236.1e94be",
        "order": 5,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "7a0b4877.a5d268",
        "type": "ui_group",
        "z": "",
        "name": "Navigation",
        "tab": "181bb236.1e94be",
        "order": 6,
        "disp": false,
        "width": "10",
        "collapse": false
    },
    {
        "id": "404c301a.19c4e",
        "type": "ui_group",
        "name": "Fraction size",
        "tab": "c9194f02.9d5e9",
        "order": 2,
        "disp": true,
        "width": "10",
        "collapse": false
    },
    {
        "id": "4322c187.e73e5",
        "type": "ui_group",
        "name": "Acquisition",
        "tab": "c9194f02.9d5e9",
        "order": 3,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "b7919ae2.c01788",
        "type": "ui_group",
        "z": "",
        "name": "Navigation",
        "tab": "c9194f02.9d5e9",
        "order": 6,
        "disp": false,
        "width": "10",
        "collapse": false
    },
    {
        "id": "b5d61bc7.54fe48",
        "type": "ui_group",
        "z": "",
        "name": "Statistics",
        "tab": "c9194f02.9d5e9",
        "order": 4,
        "disp": true,
        "width": "10",
        "collapse": false
    },
    {
        "id": "1be83144.4fe4bf",
        "type": "ui_group",
        "z": "",
        "name": "Danger Zone (DO NOT TOUCH HERE UNLESS YOU KNOW WHAT YOU ARE DOING)",
        "tab": "2489e51c.eed77a",
        "order": 2,
        "disp": true,
        "width": "12",
        "collapse": true
    },
    {
        "id": "3ca00bf9.e5cac4",
        "type": "ui_group",
        "z": "",
        "name": "Navigation",
        "tab": "d9cd733b.ab73d",
        "order": 7,
        "disp": true,
        "width": 6,
        "collapse": false
    },
    {
        "id": "b5ba3f26.2e722",
        "type": "ui_group",
        "name": "CPU Temperature",
        "tab": "d9cd733b.ab73d",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "806d69c8.67fc58",
        "type": "ui_group",
        "name": "Memory",
        "tab": "d9cd733b.ab73d",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "405183bc.d8991c",
        "type": "ui_group",
        "name": "Disk Usage",
        "tab": "d9cd733b.ab73d",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "8dc3722c.06efa8",
        "type": "mqtt-broker",
        "name": "",
        "broker": "0.0.0.0",
        "port": "1883",
        "clientid": "Client_node",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willPayload": ""
    },
    {
        "id": "abeb6dad.635a2",
        "type": "ui_group",
        "z": "",
        "name": "Control",
        "tab": "8d16beb8.9b3fb",
        "order": 1,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "cf5d9f0e.d57e7",
        "type": "ui_group",
        "z": "",
        "name": "Net Metadata",
        "tab": "737ec584.2eea2c",
        "order": 3,
        "disp": true,
        "width": "10",
        "collapse": false
    },
    {
        "id": "ce9e278.781eed8",
        "type": "ui_group",
        "name": "Information",
        "tab": "d9cd733b.ab73d",
        "order": 5,
        "disp": true,
        "width": 6,
        "collapse": false
    },
    {
        "id": "70de8209.68416c",
        "type": "ui_group",
        "z": "",
        "name": "Status",
        "tab": "c9194f02.9d5e9",
        "order": 5,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "46be9c86.dea684",
        "type": "ui_group",
        "z": "",
        "name": "Status",
        "tab": "8d16beb8.9b3fb",
        "order": 2,
        "disp": true,
        "width": 10,
        "collapse": false
    },
    {
        "id": "8c38a81e.9897a8",
        "type": "ui_group",
        "z": "",
        "name": "Camera Settings",
        "tab": "181bb236.1e94be",
        "order": 3,
        "disp": true,
        "width": "10",
        "collapse": false
    },
    {
        "id": "b001a150.faa548",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "46be9c86.dea684",
        "order": 3,
        "width": 3,
        "height": 1
    },
    {
        "id": "e900ba8d.100b6",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "46be9c86.dea684",
        "order": 5,
        "width": 3,
        "height": 1
    },
    {
        "id": "a082e7cf.54863",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "46be9c86.dea684",
        "order": 7,
        "width": 10,
        "height": 1
    },
    {
        "id": "52d1b77.28369c8",
        "type": "ui_group",
        "z": "",
        "name": "USB Backup",
        "tab": "d9cd733b.ab73d",
        "order": 6,
        "disp": true,
        "width": "6",
        "collapse": true
    },
    {
        "id": "a411788e.45a8c8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "4322c187.e73e5",
        "order": 8,
        "width": 10,
        "height": 1
    },
    {
        "id": "d4c1caa0.890fd8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b5d61bc7.54fe48",
        "order": 2,
        "width": 2,
        "height": 1
    },
    {
        "id": "79ebf4e3.1b427c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b5d61bc7.54fe48",
        "order": 4,
        "width": 2,
        "height": 1
    },
    {
        "id": "75450d64.f4d56c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b5d61bc7.54fe48",
        "order": 5,
        "width": 2,
        "height": 1
    },
    {
        "id": "6b099e83.09f0c8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b5d61bc7.54fe48",
        "order": 6,
        "width": 2,
        "height": 1
    },
    {
        "id": "2644b2c2.9c138e",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b5d61bc7.54fe48",
        "order": 7,
        "width": 2,
        "height": 1
    },
    {
        "id": "fca12a17.304738",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b5d61bc7.54fe48",
        "order": 8,
        "width": 2,
        "height": 1
    },
    {
        "id": "76e8a3c5.176964",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "b7919ae2.c01788",
        "order": 2,
        "width": 5,
        "height": 1
    },
    {
        "id": "226903fb.014ba4",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "3e1ba03d.f01d8",
        "order": 9,
        "width": 5,
        "height": 1
    },
    {
        "id": "a393ee49.38373",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "cf5d9f0e.d57e7",
        "order": 13,
        "width": 4,
        "height": 1
    },
    {
        "id": "a7d64879.38298",
        "type": "ui_group",
        "z": "",
        "name": "Python Log",
        "tab": "2489e51c.eed77a",
        "order": 1,
        "disp": true,
        "width": "12",
        "collapse": true
    },
    {
        "id": "537a50c5.f6f428",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "3ca00bf9.e5cac4",
        "order": 2,
        "width": 1,
        "height": 1
    },
    {
        "id": "9e409235.73cd7",
        "type": "ui_group",
        "z": "",
        "name": "Add a new network",
        "tab": "1b49ae0f.602d6a",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "919923a3.d10868",
        "type": "ui_group",
        "z": "",
        "name": "Current Connection",
        "tab": "1b49ae0f.602d6a",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "1b49ae0f.602d6a",
        "type": "ui_tab",
        "z": "",
        "name": "Wifi",
        "icon": "wifi",
        "order": 8,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "9f545703.7f44b8",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "9e409235.73cd7",
        "order": 4,
        "width": 6,
        "height": 1
    },
    {
        "id": "2489e51c.eed77a",
        "type": "ui_tab",
        "z": "",
        "name": "Administration",
        "icon": "dashboard",
        "order": 9,
        "disabled": false,
        "hidden": false
    },
    {
        "id": "dcb4c0a9.288b38",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1be83144.4fe4bf",
        "order": 2,
        "width": 3,
        "height": 1
    },
    {
        "id": "778e749.ced338c",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1be83144.4fe4bf",
        "order": 4,
        "width": 3,
        "height": 1
    },
    {
        "id": "e7b7752b.d85918",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1be83144.4fe4bf",
        "order": 5,
        "width": 4,
        "height": 1
    },
    {
        "id": "8bc9bd19.816888",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1be83144.4fe4bf",
        "order": 7,
        "width": 4,
        "height": 1
    },
    {
        "id": "165dcd04.e6d253",
        "type": "ui_spacer",
        "name": "spacer",
        "group": "1be83144.4fe4bf",
        "order": 9,
        "width": 8,
        "height": 1
    },
    {
        "id": "4e78af2d.90be7",
        "type": "ui_ui_control",
        "z": "eaae323a.31b3",
        "name": "",
        "events": "change",
        "x": 560,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "2a65c3ec.49a6bc",
        "type": "function",
        "z": "eaae323a.31b3",
        "name": "swtich tab",
        "func": "\nmsg.payload={\"tab\":msg.payload};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 400,
        "y": 160,
        "wires": [
            [
                "4e78af2d.90be7"
            ]
        ]
    },
    {
        "id": "9d6abe67.6bb3d",
        "type": "ui_button",
        "z": "cb95299c.2817c8",
        "name": "",
        "group": "64903b47.4034e4",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Home",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "home",
        "payload": "{\"tab\":\"Home\"}",
        "payloadType": "json",
        "topic": "",
        "x": 410,
        "y": 460,
        "wires": [
            [
                "f0fb77cf.8f1c28"
            ]
        ]
    },
    {
        "id": "f0fb77cf.8f1c28",
        "type": "ui_ui_control",
        "z": "cb95299c.2817c8",
        "name": "",
        "events": "change",
        "x": 720,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "2c8c45ab.610c0a",
        "type": "ui_gauge",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "b5ba3f26.2e722",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "CPU Temperature",
        "label": "°C",
        "format": "{{value}}",
        "min": "30",
        "max": "55",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 610,
        "y": 100,
        "wires": []
    },
    {
        "id": "ddcbbfa5.cd158",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "vcgencmd measure_temp | tr -d \"temp=\" | tr -d \"'C\" | tr -d \"\\n\"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "RPi Temp.",
        "x": 330,
        "y": 120,
        "wires": [
            [
                "bc503fa5.f46dd",
                "2c8c45ab.610c0a",
                "cef370c7.1f7a"
            ],
            [],
            []
        ]
    },
    {
        "id": "cef370c7.1f7a",
        "type": "ui_chart",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "b5ba3f26.2e722",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "30",
        "ymax": "60",
        "removeOlder": "20",
        "removeOlderPoints": "200",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 570,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "55749fd8.3aca5",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "top -d 0.5 -b -n2 | grep \"Cpu(s)\"|tail -n 1 | awk '{print $2 + $4}' | tr -d \"\\n\"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "CPU Load",
        "x": 330,
        "y": 200,
        "wires": [
            [
                "e046247c.c466e8",
                "4b2b9a70.6a9af4"
            ],
            [],
            []
        ]
    },
    {
        "id": "c2b8d8b.0d90328",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "free | grep Mem | awk '{print 100*($2-$7)/$2}' | awk '{print int($1+0.5)}' | tr -d \"\\n\"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "Free Memory",
        "x": 340,
        "y": 280,
        "wires": [
            [
                "e84f6e08.5d147",
                "c7c8d192.3df27"
            ],
            [],
            []
        ]
    },
    {
        "id": "e046247c.c466e8",
        "type": "ui_gauge",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "3da7da8f.179606",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Processor",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 590,
        "y": 180,
        "wires": []
    },
    {
        "id": "e84f6e08.5d147",
        "type": "ui_gauge",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "806d69c8.67fc58",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Memory",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 580,
        "y": 260,
        "wires": []
    },
    {
        "id": "3910d662.fa1f7a",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "df -h | grep /dev/root | awk -F ' ' '{print $5}' | tr -d % | tr \"\\n$\" \"\\ \" |  sed 's/,/./' | tr -d \" \"",
        "addpay": false,
        "append": "",
        "useSpawn": "",
        "timer": "",
        "name": "Disk Usage",
        "x": 330,
        "y": 360,
        "wires": [
            [
                "45e1912a.36a23",
                "84ac8611.1a6ac8",
                "eaf74a43.fa27d"
            ],
            [],
            []
        ]
    },
    {
        "id": "45e1912a.36a23",
        "type": "ui_gauge",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "405183bc.d8991c",
        "order": 1,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Disk",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "x": 570,
        "y": 340,
        "wires": []
    },
    {
        "id": "4b2b9a70.6a9af4",
        "type": "ui_chart",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "3da7da8f.179606",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 570,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "c7c8d192.3df27",
        "type": "ui_chart",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "806d69c8.67fc58",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": "20",
        "removeOlderPoints": "",
        "removeOlderUnit": "60",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 570,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "84ac8611.1a6ac8",
        "type": "ui_chart",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "405183bc.d8991c",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "0",
        "ymax": "100",
        "removeOlder": "4",
        "removeOlderPoints": "200",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 570,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "1cd5b4c0.46af9b",
        "type": "inject",
        "z": "1371dec5.76e671",
        "name": "update: 15s",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 240,
        "wires": [
            [
                "3910d662.fa1f7a",
                "c2b8d8b.0d90328",
                "55749fd8.3aca5",
                "ddcbbfa5.cd158"
            ]
        ]
    },
    {
        "id": "8485d05.444903",
        "type": "ui_switch",
        "z": "1371dec5.76e671",
        "name": "fan_state",
        "label": "Fan",
        "tooltip": "",
        "group": "3ca00bf9.e5cac4",
        "order": 3,
        "width": 1,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "on",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "off",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 940,
        "y": 40,
        "wires": [
            [
                "2549f778.4eb828"
            ]
        ]
    },
    {
        "id": "2549f778.4eb828",
        "type": "python3-function",
        "z": "1371dec5.76e671",
        "name": "fan control",
        "func": "#!/usr/bin/python\nimport smbus\n\nstate = msg[\"payload\"]\n\nbus = smbus.SMBus(1)\n\nDEVICE_ADDRESS = 0x0d\n\nif state == \"off\":\n    bus.write_byte_data(DEVICE_ADDRESS, 0x08, 0x00)\nif state == \"on\":\n    bus.write_byte_data(DEVICE_ADDRESS, 0x08, 0x01)\n",
        "outputs": 1,
        "x": 1110,
        "y": 40,
        "wires": [
            [
                "b7ab1ada.1f4158"
            ]
        ]
    },
    {
        "id": "b7ab1ada.1f4158",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "i2cdetect -y 1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "1",
        "oldrc": false,
        "name": "i2c update",
        "x": 1290,
        "y": 40,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "bc503fa5.f46dd",
        "type": "switch",
        "z": "1371dec5.76e671",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "40",
                "vt": "num"
            },
            {
                "t": "lte",
                "v": "35",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 40,
        "wires": [
            [
                "a25d6486.e1ce28"
            ],
            [
                "5d4f3e71.1bad4"
            ]
        ]
    },
    {
        "id": "5d4f3e71.1bad4",
        "type": "change",
        "z": "1371dec5.76e671",
        "name": "Set OFF",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "off",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 60,
        "wires": [
            [
                "8485d05.444903"
            ]
        ]
    },
    {
        "id": "a25d6486.e1ce28",
        "type": "change",
        "z": "1371dec5.76e671",
        "name": "Set ON",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "on",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 20,
        "wires": [
            [
                "8485d05.444903"
            ]
        ]
    },
    {
        "id": "6a84252a.d52a0c",
        "type": "ui_template",
        "z": "bccd1f23.87219",
        "group": "833bc5bb.217ba8",
        "name": "Stream Pi Camera",
        "order": 1,
        "width": 18,
        "height": 14,
        "format": "<center>\n  <img src=\"http://planktoscope.local:8000/stream.mjpg\"\n    width=\"100%\" height=\"100%\">\n</center>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 110,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "dc48dc42.98d18",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "set global",
        "func": "global.set(msg.topic,msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 880,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "f59a2f0d.5e9af",
        "type": "ui_numeric",
        "z": "baa1e3d9.cb29d",
        "name": "acq_minimum_mesh",
        "label": "Min fraction size (μm)",
        "tooltip": "",
        "group": "404c301a.19c4e",
        "order": 1,
        "width": 5,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "acq_minimum_mesh",
        "format": "{{value}}",
        "min": 0,
        "max": "300",
        "step": "10",
        "x": 600,
        "y": 120,
        "wires": [
            [
                "fb887036.12429"
            ]
        ]
    },
    {
        "id": "6008a8bb.259f08",
        "type": "ui_numeric",
        "z": "baa1e3d9.cb29d",
        "name": "acq_maximum_mesh",
        "label": "Max fraction size (μm)",
        "tooltip": "",
        "group": "404c301a.19c4e",
        "order": 2,
        "width": 5,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "acq_maximum_mesh",
        "format": "{{value}}",
        "min": "200",
        "max": "2000",
        "step": "100",
        "x": 600,
        "y": 160,
        "wires": [
            [
                "fb887036.12429"
            ]
        ]
    },
    {
        "id": "6b34c456.83178c",
        "type": "ui_text_input",
        "z": "baa1e3d9.cb29d",
        "name": "acq_id",
        "label": "Acquisition unique ID*",
        "tooltip": "",
        "group": "4322c187.e73e5",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "acq_id",
        "x": 650,
        "y": 240,
        "wires": [
            [
                "fb887036.12429"
            ]
        ]
    },
    {
        "id": "7789839d.69b48c",
        "type": "ui_template",
        "z": "eaae323a.31b3",
        "group": "4e0cd5ea.17e59c",
        "name": "Optic Configuration",
        "order": 1,
        "width": 4,
        "height": 4,
        "format": "<md-button ng-click=\"send({payload:'Optic Configuration'})\" style=\"height:100%;\">\n    <i class=\"fa fa-eye fa-5x\"></i>\n    <div style=\"margin-top:30px;\">Optic Configuration</div>\n</md-button>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "2a65c3ec.49a6bc"
            ]
        ]
    },
    {
        "id": "6ea6c306.f9c12c",
        "type": "ui_template",
        "z": "eaae323a.31b3",
        "group": "ef590206.24f6",
        "name": "Fluidic Acquisition",
        "order": 1,
        "width": 4,
        "height": 4,
        "format": "<md-button ng-click=\"send({payload:'Fluidic Acquisition'})\" style=\"height:100%;\">\n    <i class=\"fa fa-flask fa-5x\"></i>\n    <div style=\"margin-top:30px;\">Fluidic Acquisition</div>\n</md-button>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "2a65c3ec.49a6bc"
            ]
        ]
    },
    {
        "id": "bb9eb153.9e36c",
        "type": "ui_template",
        "z": "eaae323a.31b3",
        "group": "ae8f6620.073358",
        "name": "Segmentation",
        "order": 1,
        "width": 4,
        "height": 4,
        "format": "<md-button ng-click=\"send({payload:'Segmentation'})\" style=\"height:100%;\">\n    <i class=\"fa fa-crop fa-5x\"></i>\n    <div style=\"margin-top:30px;\">Segmentation</div>\n</md-button>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 140,
        "y": 180,
        "wires": [
            [
                "2a65c3ec.49a6bc"
            ]
        ]
    },
    {
        "id": "eaf8ee7f.96f44",
        "type": "ui_template",
        "z": "eaae323a.31b3",
        "group": "196518b2.4d53b7",
        "name": "Gallery",
        "order": 1,
        "width": 4,
        "height": 4,
        "format": "<md-button ng-click=\"send({payload:'Gallery'})\" style=\"height:100%;\">\n    <i class=\"fa fa-file-image-o fa-5x\"></i>\n    <div style=\"margin-top:30px;\">Gallery</div>\n</md-button>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 160,
        "y": 220,
        "wires": [
            [
                "2a65c3ec.49a6bc"
            ]
        ]
    },
    {
        "id": "811cd88c.daf528",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "down",
        "group": "fbd92986.1028c8",
        "order": 6,
        "width": 5,
        "height": 1,
        "passthru": true,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-angle-double-down fa-3x",
        "payload": "DOWN",
        "payloadType": "str",
        "topic": "actuator/focus",
        "x": 190,
        "y": 740,
        "wires": [
            [
                "65ad39d.b6d4d48"
            ]
        ]
    },
    {
        "id": "edda4df4.76de2",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "up",
        "group": "fbd92986.1028c8",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-angle-double-up fa-3x",
        "payload": "UP",
        "payloadType": "str",
        "topic": "actuator/focus",
        "x": 190,
        "y": 700,
        "wires": [
            [
                "65ad39d.b6d4d48"
            ]
        ]
    },
    {
        "id": "68962547.34a67c",
        "type": "ui_text_input",
        "z": "bccd1f23.87219",
        "name": "pump_manual_volume",
        "label": "Volume to pass (ml)",
        "tooltip": "",
        "group": "707d9797.c8e798",
        "order": 3,
        "width": 3,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "pump_manual_volume",
        "x": 510,
        "y": 380,
        "wires": [
            [
                "dc48dc42.98d18"
            ]
        ]
    },
    {
        "id": "34c81624.df1cea",
        "type": "ui_slider",
        "z": "bccd1f23.87219",
        "name": "pump_flowrate",
        "label": "Flowrate (ml/min)*",
        "tooltip": "",
        "group": "707d9797.c8e798",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "pump_flowrate",
        "min": 0,
        "max": "20",
        "step": "0.1",
        "x": 540,
        "y": 340,
        "wires": [
            [
                "dc48dc42.98d18"
            ]
        ]
    },
    {
        "id": "c1b1469.9650eb8",
        "type": "ui_template",
        "z": "eaae323a.31b3",
        "group": "777a7c33.fcd804",
        "name": "Settings",
        "order": 1,
        "width": 4,
        "height": 4,
        "format": "<md-button ng-click=\"send({payload:'Settings'})\" style=\"height:100%;\">\n    <i class=\"fa fa-cogs fa-5x\"></i>\n    <div style=\"margin-top:30px;\">Settings</div>\n</md-button>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 160,
        "y": 260,
        "wires": [
            [
                "2a65c3ec.49a6bc"
            ]
        ]
    },
    {
        "id": "abafd6e6.04a5f8",
        "type": "ui_template",
        "z": "eaae323a.31b3",
        "group": "6f97e7ae.270c48",
        "name": "Sample",
        "order": 1,
        "width": 4,
        "height": 4,
        "format": "<md-button ng-click=\"send({payload:'Sample'})\" style=\"height:100%;\">\n    <i class=\"fa fa-eyedropper fa-5x\"></i>\n    <div style=\"margin-top:30px;\">Sample</div>\n    <br>\n    In doubt? Start Here!\n</md-button>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 160,
        "y": 60,
        "wires": [
            [
                "2a65c3ec.49a6bc"
            ]
        ]
    },
    {
        "id": "4557d689.a4fa88",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "sample_ship",
        "label": "Name of the ship",
        "tooltip": "",
        "group": "3e1ba03d.f01d8",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "sample_ship",
        "x": 670,
        "y": 340,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "fcfc31ae.af3af",
        "type": "ui_dropdown",
        "z": "b771c342.49603",
        "name": "sample_sampling_gear",
        "label": "Sampling gear",
        "tooltip": "",
        "place": "Choose from list",
        "group": "3e1ba03d.f01d8",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "High Speed Net",
                "value": "net_hsn",
                "type": "str"
            },
            {
                "label": "Tara Decknet",
                "value": "net_decknet",
                "type": "str"
            },
            {
                "label": "Plankton net",
                "value": "net",
                "type": "str"
            },
            {
                "label": "Niskin bottle 12L",
                "value": "niskin_12L",
                "type": "str"
            },
            {
                "label": "Niskin bottle 24L",
                "value": "niskin_24L",
                "type": "str"
            },
            {
                "label": "Pass Hull",
                "value": "pass_hull",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "sample_sampling_gear",
        "x": 630,
        "y": 460,
        "wires": [
            [
                "9f501f49.45645",
                "d7c68899.f8f678"
            ]
        ]
    },
    {
        "id": "82c5fc77.59c97",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "sample_operator",
        "label": "Name of the operator",
        "tooltip": "",
        "group": "3e1ba03d.f01d8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "sample_operator",
        "x": 650,
        "y": 420,
        "wires": [
            [
                "9f501f49.45645",
                "52af9ac0.60eb24"
            ]
        ]
    },
    {
        "id": "9c882b37.fde668",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "sample_project",
        "label": "Name of the project*",
        "tooltip": "",
        "group": "3e1ba03d.f01d8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "sample_project",
        "x": 660,
        "y": 300,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "94eb4221.9b92c",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "sample_id",
        "label": "ID of the station*",
        "tooltip": "",
        "group": "3e1ba03d.f01d8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "sample_id",
        "x": 670,
        "y": 380,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "9f501f49.45645",
        "type": "function",
        "z": "b771c342.49603",
        "name": "set global",
        "func": "global.set(msg.topic,msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1080,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "cc0ca68b.4263a8",
        "type": "ui_dropdown",
        "z": "baa1e3d9.cb29d",
        "name": "acq_celltype",
        "label": "Flowcell thickness*",
        "tooltip": "",
        "place": "Select option",
        "group": "4322c187.e73e5",
        "order": 6,
        "width": 5,
        "height": 1,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "200 μm µ-Slide I Luer",
                "value": 200,
                "type": "num"
            },
            {
                "label": "300 µm capillary",
                "value": 300,
                "type": "num"
            },
            {
                "label": "400 μm µ-Slide I Luer",
                "value": 400,
                "type": "num"
            },
            {
                "label": "600 μm µ-Slide I Luer",
                "value": 600,
                "type": "num"
            },
            {
                "label": "800 μm µ-Slide I Luer",
                "value": 800,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "acq_celltype",
        "x": 630,
        "y": 200,
        "wires": [
            [
                "fb887036.12429",
                "99b11fe4.2795d"
            ]
        ]
    },
    {
        "id": "fb887036.12429",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "set global",
        "func": "global.set(msg.topic, msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 900,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "222c851d.5d0a3a",
        "type": "ui_ui_control",
        "z": "b771c342.49603",
        "name": "",
        "events": "change",
        "x": 460,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "52f6b103.1efb6",
        "type": "ui_toast",
        "z": "b771c342.49603",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 770,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "986d960a.c75908",
        "type": "function",
        "z": "b771c342.49603",
        "name": "Check form",
        "func": "var sample_project= global.get(\"sample_project\");\nvar sample_ship= global.get(\"sample_ship\");\nvar sample_id= global.get(\"sample_id\");\nvar sample_operator= global.get(\"sample_operator\");\nvar sample_sampling_gear= global.get(\"sample_sampling_gear\");\nvar object_lat= global.get(\"object_lat\");\nvar object_lon= global.get(\"object_lon\");\nvar object_date= global.get(\"object_date\");\nvar object_time= global.get(\"object_time\");\n\nif (sample_project === undefined || sample_project === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Sample project\"\n    return [null, msg];\n}\n\nelse if (sample_ship === undefined || sample_ship === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Sample ship\"\n    return [null, msg];\n}\n\nelse if (sample_id === undefined || sample_id === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Sample ID\"\n    return [null, msg];\n}\n\nelse if (sample_operator === undefined || sample_operator === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Sample operator\"\n    return [null, msg];\n}\n\nelse if (sample_sampling_gear === undefined || sample_sampling_gear === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Sample sampling gear\"\n    return [null, msg];\n}\n\nelse if (object_lat === undefined || object_lat === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Latitude of sample\"\n    return [null, msg];\n}\n\nelse if (object_lon === undefined || object_lon === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Longitude of sample\"\n    return [null, msg];\n}\n\nelse if (object_date === undefined || object_date === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Date of sample\"\n    return [null, msg];\n}\n\nelse if (object_time === undefined || object_time === \"\") {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Time of sample\"\n    return [null, msg];\n}\nelse if (sample_sampling_gear == \"net\"){\n    var object_lat_end= global.get(\"object_lat_end\");\n    var object_lon_end= global.get(\"object_lon_end\");\n    var object_date_end= global.get(\"object_date_end\");\n    var object_time_end= global.get(\"object_time_end\");\n\n    if (object_lat_end === undefined || object_lat_end === null) {\n        msg.topic = \"Missing entry :\"\n        msg.payload = \"Latitude of retrieval\"\n        return [null, msg];\n    }\n    \n    else if (object_lon_end === undefined || object_lon_end === null) {\n        msg.topic = \"Missing entry :\"\n        msg.payload = \"Longitude of retrieval\"\n        return [null, msg];\n    }\n    \n    else if (object_date_end === undefined || object_date_end === \"\") {\n        msg.topic = \"Missing entry :\"\n        msg.payload = \"Date of retrieval\"\n        return [null, msg];\n    }\n    \n    else if (object_time_end === undefined || object_time_end === \"\") {\n        msg.topic = \"Missing entry :\"\n        msg.payload = \"Time of retrieval\"\n        return [null, msg];\n    }\n}\nmsg.topic = \"Change Tab\"\nmsg.payload={\"tab\":\"Optic Configuration\"};\n\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 470,
        "y": 1360,
        "wires": [
            [
                "726a7822.cd6298",
                "e2b277c1.07283"
            ],
            [
                "52f6b103.1efb6"
            ]
        ],
        "outputLabels": [
            "message",
            "error"
        ]
    },
    {
        "id": "18f44504.cac66b",
        "type": "gpsd",
        "z": "b771c342.49603",
        "name": "",
        "hostname": "localhost",
        "port": "2947",
        "tpv": true,
        "sky": false,
        "info": false,
        "device": false,
        "gst": false,
        "att": false,
        "x": 290,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "726a7822.cd6298",
        "type": "ui_ui_control",
        "z": "b771c342.49603",
        "name": "",
        "events": "change",
        "x": 760,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "2d128018.6a809",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_lat",
        "label": "Latitude",
        "tooltip": "36.5794° N",
        "group": "cf5d9f0e.d57e7",
        "order": 3,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "object_lat",
        "x": 620,
        "y": 820,
        "wires": [
            [
                "7953b1b2.d53ed8"
            ]
        ]
    },
    {
        "id": "4626c0da.e0dd5",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_lon",
        "label": "Longitude",
        "tooltip": "110.421° W",
        "group": "cf5d9f0e.d57e7",
        "order": 4,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "object_lon",
        "x": 610,
        "y": 860,
        "wires": [
            [
                "7953b1b2.d53ed8"
            ]
        ]
    },
    {
        "id": "f00f321f.77d76",
        "type": "ui_date_picker",
        "z": "b771c342.49603",
        "name": "object_date",
        "label": "Date",
        "group": "cf5d9f0e.d57e7",
        "order": 5,
        "width": 5,
        "height": 1,
        "passthru": true,
        "topic": "object_date",
        "x": 1250,
        "y": 820,
        "wires": [
            [
                "29f2b365.4327ec"
            ]
        ]
    },
    {
        "id": "207fbdbb.2fe2a2",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_time",
        "label": "Time",
        "tooltip": "UTC time, 03:23:00 or 15:45",
        "group": "cf5d9f0e.d57e7",
        "order": 6,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "object_time",
        "x": 1250,
        "y": 860,
        "wires": [
            [
                "1a945afa.d60aad"
            ]
        ]
    },
    {
        "id": "6c792043.b6ff9",
        "type": "ui_ui_control",
        "z": "bccd1f23.87219",
        "name": "",
        "events": "change",
        "x": 560,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "902429eb.ceacb8",
        "type": "ui_toast",
        "z": "bccd1f23.87219",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 570,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "fe840e05.b46f3",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Check form",
        "func": "var acq_fnumber_objective= global.get(\"acq_fnumber_objective\");\n\nif (acq_fnumber_objective === undefined || acq_fnumber_objective === \"\") {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Focal Length of the objective\";\n    return [null, msg];\n}\n\nmsg.topic = \"Change Tab\";\nmsg.payload={\"tab\":\"Fluidic Acquisition\"};\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 330,
        "y": 1260,
        "wires": [
            [
                "6c792043.b6ff9"
            ],
            [
                "902429eb.ceacb8"
            ]
        ],
        "outputLabels": [
            "message",
            "error"
        ]
    },
    {
        "id": "5846b1d4.7971b",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "Backward",
        "group": "707d9797.c8e798",
        "order": 2,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-rotate-left fa-2x",
        "payload": "BACKWARD",
        "payloadType": "str",
        "topic": "actuator/pump",
        "x": 180,
        "y": 220,
        "wires": [
            [
                "3cb96380.e575ec"
            ]
        ]
    },
    {
        "id": "2cab680b.baf888",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "Forward",
        "group": "707d9797.c8e798",
        "order": 4,
        "width": 2,
        "height": 1,
        "passthru": true,
        "label": "",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-rotate-right fa-2x",
        "payload": "FORWARD",
        "payloadType": "str",
        "topic": "actuator/pump",
        "x": 180,
        "y": 260,
        "wires": [
            [
                "3cb96380.e575ec"
            ]
        ]
    },
    {
        "id": "961d27e7.da65c8",
        "type": "ui_switch",
        "z": "bccd1f23.87219",
        "name": "light_state",
        "label": "Light",
        "tooltip": "",
        "group": "4248342d.e55fac",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 280,
        "y": 40,
        "wires": [
            [
                "cbb8afed.0a026"
            ]
        ],
        "icon": "font-awesome/fa-lightbulb-o"
    },
    {
        "id": "cc966678.da8d08",
        "type": "ui_dropdown",
        "z": "bccd1f23.87219",
        "name": "acq_fnumber_objective",
        "label": "M12 Lens*",
        "tooltip": "",
        "place": "Select option",
        "group": "4248342d.e55fac",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "f 25mm 1/2\" 5MP IR",
                "value": 25,
                "type": "num"
            },
            {
                "label": "f 16mm 1/2.5\" 5MP IR",
                "value": 16,
                "type": "num"
            },
            {
                "label": "f 12mm 1/2.5\" 5MP IR",
                "value": 12,
                "type": "num"
            },
            {
                "label": "f 8mm 1/2.5\" 5MP IR",
                "value": 8,
                "type": "num"
            },
            {
                "label": "f 6mm 1/2.5\" 5MP IR",
                "value": 6,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "acq_fnumber_objective",
        "x": 1190,
        "y": 140,
        "wires": [
            [
                "8038414a.34461"
            ]
        ]
    },
    {
        "id": "9b515beb.4aea48",
        "type": "ui_template",
        "z": "bccd1f23.87219",
        "group": "4248342d.e55fac",
        "name": "Magnification",
        "order": 3,
        "width": 0,
        "height": 0,
        "format": "<div>\n    Magnification : X\n    <span id=\"obj_magnification\" ng-bind-html=\"msg.payload\">\n    </span>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 1680,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "8038414a.34461",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Calculate optics",
        "func": "global.set(msg.topic,msg.payload);\n\nvar acq_fnumber_objective = String(global.get(msg.topic));\nvar acq_camera = global.get(\"acq_camera\")\n\n// Those values needs to be recalculated, they are not good!\nif (acq_camera == \"HQ Camera\"){\n    switch(acq_fnumber_objective) {\n      case \"25\":\n        acq_magnification= 0.6;\n        process_pixel= 1.56;\n        sug_min= 60;\n        sug_max= 670;\n        sug_flowrate= 3;\n        break;\n      case \"16\":\n        acq_magnification= 1.6;\n        process_pixel= 1;\n        sug_min= 40;\n        sug_max= 430;\n        sug_flowrate= 2.4;\n        break;\n      case \"12\":\n        acq_magnification= 1.20;\n        process_pixel= 0.79;\n        sug_min= 30;\n        sug_max= 340;\n        sug_flowrate= 1.25;\n        break;\n      case \"8\":\n        acq_magnification= 1.78;\n        process_pixel= 0.53;\n        sug_min= 20;\n        sug_max= 230;\n        sug_flowrate= 0.42;\n        break;\n      case \"6\":\n        acq_magnification= 2.36;\n        process_pixel= 0.41;\n        sug_min= 15;\n        sug_max= 170;\n        sug_flowrate= 0.32;\n        break;\n    }\n}\nelse if (acq_camera == \"Camera v2.1\"){\n    switch(acq_fnumber_objective) {\n      case \"25\":\n        acq_magnification= 0.6;\n        process_pixel= 1.86;\n        sug_min= 60;\n        sug_max= 670;\n        sug_flowrate= 3;\n        break;\n      case \"16\":\n        acq_magnification= 1.6;\n        process_pixel= 0.7;\n        sug_min= 40;\n        sug_max= 430;\n        sug_flowrate= 2.4;\n        break;\n      case \"12\":\n        acq_magnification= 1.20;\n        process_pixel= 0.94;\n        sug_min= 30;\n        sug_max= 340;\n        sug_flowrate= 1.25;\n        break;\n      case \"8\":\n        acq_magnification= 1.78;\n        process_pixel= 0.63;\n        sug_min= 20;\n        sug_max= 230;\n        sug_flowrate= 0.42;\n        break;\n      case \"6\":\n        acq_magnification= 2.36;\n        process_pixel= 0.48;\n        sug_min= 15;\n        sug_max= 170;\n        sug_flowrate= 0.32;\n        break;\n    }\n}else {\n    acq_magnification= \"ERROR\";\n    process_pixel= \"ERROR\";\n    sug_min= \"ERROR\";\n    sug_max= \"ERROR\";\n    sug_flowrate= \"ERROR\";\n}\nglobal.set(\"acq_magnification\",acq_magnification);\nglobal.set(\"process_pixel\",process_pixel);\n\nreturn [{payload: acq_magnification}, {payload: process_pixel}, {payload: sug_min}, {payload: sug_max}, {payload: sug_flowrate}];",
        "outputs": 5,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1440,
        "y": 160,
        "wires": [
            [
                "9b515beb.4aea48"
            ],
            [
                "3d2360ad.e41e7"
            ],
            [
                "8e66977b.9166a8"
            ],
            [
                "26b32f2c.c64fc"
            ],
            []
        ],
        "inputLabels": [
            "acq_fnumber_objective"
        ],
        "outputLabels": [
            "acq_magnification",
            "process_pixel",
            "sug_min",
            "sug_max",
            "sug_flowrate"
        ]
    },
    {
        "id": "3d2360ad.e41e7",
        "type": "ui_template",
        "z": "bccd1f23.87219",
        "group": "4248342d.e55fac",
        "name": "process_pixel",
        "order": 4,
        "width": 0,
        "height": 0,
        "format": "<div>\n    Pixel resolution :\n    <span id=\"process_pixel\" ng-bind-html=\"msg.payload\"></span>\n    μm\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 1680,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "8e66977b.9166a8",
        "type": "ui_template",
        "z": "bccd1f23.87219",
        "group": "4248342d.e55fac",
        "name": "min_size",
        "order": 5,
        "width": 0,
        "height": 0,
        "format": "<div>\n    Smallest cells to explore :\n    <span id=\"min_size\" ng-bind-html=\"msg.payload\"></span>\n    μm\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 1660,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "26b32f2c.c64fc",
        "type": "ui_template",
        "z": "bccd1f23.87219",
        "group": "4248342d.e55fac",
        "name": "max_size",
        "order": 6,
        "width": 0,
        "height": 0,
        "format": "<div>\n    Biggest cells to explore :\n    <span id=\"max_size\" ng-bind-html=\"msg.payload\"></span>\n    μm\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "templateScope": "local",
        "x": 1660,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "bb2bb7ce.1d1458",
        "type": "ui_template",
        "z": "baa1e3d9.cb29d",
        "group": "858a0e3c.987fe",
        "name": "Stream Pi Camera",
        "order": 1,
        "width": 10,
        "height": 8,
        "format": "<center>\n  <img src=\"http://planktoscope.local:8000/stream.mjpg\"\n    width=\"100%\" height=\"100%\">\n</center>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 910,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "d0c5b57d.590818",
        "type": "ui_ui_control",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "events": "change",
        "x": 1340,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "16de754c.cc969b",
        "type": "ui_button",
        "z": "b771c342.49603",
        "name": "",
        "group": "5517c651.b2f668",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Previous",
        "tooltip": "",
        "color": "#097479",
        "bgcolor": "white",
        "icon": "keyboard_return",
        "payload": "{\"tab\":\"Home\"}",
        "payloadType": "json",
        "topic": "",
        "x": 300,
        "y": 1300,
        "wires": [
            [
                "222c851d.5d0a3a"
            ]
        ]
    },
    {
        "id": "84f3d040.5f7ea",
        "type": "ui_button",
        "z": "b771c342.49603",
        "name": "",
        "group": "5517c651.b2f668",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Continue",
        "tooltip": "",
        "color": "#097479",
        "bgcolor": "white",
        "icon": "keyboard_tab",
        "payload": "{\"tab\":\"Home\"}",
        "payloadType": "json",
        "topic": "",
        "x": 300,
        "y": 1360,
        "wires": [
            [
                "986d960a.c75908"
            ]
        ]
    },
    {
        "id": "f61aaed5.1e64",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "",
        "group": "7a0b4877.a5d268",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Previous",
        "tooltip": "",
        "color": "#097479",
        "bgcolor": "white",
        "icon": "keyboard_return",
        "payload": "{\"tab\":\"Sample\"}",
        "payloadType": "json",
        "topic": "",
        "x": 140,
        "y": 1220,
        "wires": [
            [
                "6c792043.b6ff9"
            ]
        ]
    },
    {
        "id": "9ba6ec0a.22c96",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "",
        "group": "7a0b4877.a5d268",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Continue",
        "tooltip": "",
        "color": "#097479",
        "bgcolor": "white",
        "icon": "keyboard_tab",
        "payload": "{\"tab\":\"Home\"}",
        "payloadType": "json",
        "topic": "",
        "x": 140,
        "y": 1260,
        "wires": [
            [
                "fe840e05.b46f3"
            ]
        ]
    },
    {
        "id": "c72f8fae.23bd4",
        "type": "ui_button",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "group": "b7919ae2.c01788",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Previous",
        "tooltip": "",
        "color": "#097479",
        "bgcolor": "white",
        "icon": "keyboard_return",
        "payload": "{\"tab\":\"Optic Configuration\"}",
        "payloadType": "json",
        "topic": "",
        "x": 1200,
        "y": 40,
        "wires": [
            [
                "d0c5b57d.590818"
            ]
        ]
    },
    {
        "id": "29be525e.0c87fe",
        "type": "ui_template",
        "z": "baa1e3d9.cb29d",
        "group": "b5d61bc7.54fe48",
        "name": "Show Metadata",
        "order": 9,
        "width": 0,
        "height": 0,
        "format": "<div>\n    <table style=\"text-align: center; width:100%\">\n        <tr style=\"vertical-align: top\">\n            <td>\n                <h2>Sample</h2><br>\n                <strong>project:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_project\"></span><br>\n                <strong>ship:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_ship\"></span><br>\n                <strong>operator:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_operator\"></span><br>\n                <strong>id:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_id\"></span><br>\n                <strong>sampling gear:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_sampling_gear\"></span><br>\n                <strong>concentrated volume:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_concentrated_sample_volume\"></span><br>\n                <strong>gear net opening:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sample_gear_net_opening\"></span><br></td>\n            <td>\n                <h2>Acquisition</h2><br>\n                <strong>id:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_id\"></span><br>\n                <strong>instrument:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_instrument\"></span><br>\n                <strong>instrument id:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_instrument_id\"></span><br>\n                <strong>camera:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_camera\"></span><br>\n                <strong>celltype:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_celltype\"></span><br>\n                <strong>minimum mesh:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_minimum_mesh\"></span><br>\n                <strong>maximum mesh:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_maximum_mesh\"></span><br>\n                <strong>min esd:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_min_esd\"></span><br>\n                <strong>max esd:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_max_esd\"></span><br>\n                <strong>volume:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_volume\"></span><br>\n                <strong>magnification:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_magnification\"></span><br>\n                <strong>fnumber objective:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_fnumber_objective\"></span><br>\n                <strong>software:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.acq_software\"></span><br>\n                <strong>flowrate:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.sug_flowrate\"></span><br></td>\n        </tr>\n        <tr style=\"vertical-align: top\">\n            <td>\n                <h2>Object</h2><br>\n                <strong>latitude:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_lat\"></span><br>\n                <strong>longitude:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_lon\"></span><br>\n                <strong>latitude end:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_lat_end\"></span><br>\n                <strong>longitude end:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_lon_end\"></span><br>\n                <strong>date:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_date\"></span><br>\n                <strong>time:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_time\"></span><br>\n                <strong>date end:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_date_end\"></span><br>\n                <strong>time end:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_time_end\"></span><br>\n                <strong>depth min:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_depth_min\"></span><br>\n                <strong>depth max:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.object_depth_max\"></span><br></td>\n            <td>\n                <h2>Process</h2><br>\n                <strong>pixel:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.process_pixel\"></span><br>\n                <strong>id:</strong> <span id=\"max_size\" ng-bind-html=\"msg.payload.config.process_id\"></span></td>\n        </tr>\n    </table>\n</div>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 1260,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "cbb8afed.0a026",
        "type": "rpi-gpio out",
        "z": "bccd1f23.87219",
        "name": "LED Output",
        "pin": "40",
        "set": true,
        "level": "0",
        "freq": "",
        "out": "out",
        "x": 450,
        "y": 40,
        "wires": []
    },
    {
        "id": "3cb96380.e575ec",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "pump",
        "func": "var manual_volume= global.get(\"pump_manual_volume\");\nvar flowrate= global.get(\"pump_flowrate\");\n\nif (manual_volume === undefined || manual_volume === \"\" || manual_volume === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Volume to pass\";\n    return [null, msg];\n}\nelse if (flowrate === undefined || flowrate === \"\" || flowrate === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Flowrate\";\n    return [null, msg];\n}\nelse {\n    msg.topic = \"actuator/pump\";\n    // msg.payload is FORWARD or BACKWARD here\n    msg.payload={\"action\":\"move\", \n                \"direction\":msg.payload,\n                \"volume\":manual_volume,\n                \"flowrate\":flowrate};\n}\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 240,
        "wires": [
            [
                "bdc8ce57.de1f08"
            ],
            [
                "8bcce348.efc1a"
            ]
        ],
        "inputLabels": [
            "direction"
        ],
        "outputLabels": [
            "message",
            "error"
        ]
    },
    {
        "id": "8bcce348.efc1a",
        "type": "ui_toast",
        "z": "bccd1f23.87219",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 570,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "bdc8ce57.de1f08",
        "type": "mqtt out",
        "z": "bccd1f23.87219",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 550,
        "y": 180,
        "wires": []
    },
    {
        "id": "3d31ee98.a7d6fa",
        "type": "ui_text_input",
        "z": "bccd1f23.87219",
        "name": "focus_distance",
        "label": "Distance in µm",
        "tooltip": "This will be rounded to the nearest 25µm",
        "group": "fbd92986.1028c8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "focus_distance",
        "x": 400,
        "y": 440,
        "wires": [
            [
                "dbd6bde.99db64"
            ]
        ]
    },
    {
        "id": "d71d224f.0585d8",
        "type": "ui_toast",
        "z": "bccd1f23.87219",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 670,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "65ad39d.b6d4d48",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "focus",
        "func": "var distance = global.get(\"focus_distance\");\n\nif (distance === undefined || distance === \"\" || distance === null) {\n    msg.topic = \"Missing entry :\"\n    msg.payload = \"Distance\";\n    return [null, msg]\n}else {\n    distance = global.get(\"focus_distance\");\n    // msg.payload is UP or DOWN here\n    msg.payload={\"action\":\"move\", \n                \"direction\":msg.payload,\n                \"distance\":(distance/1000)};\n}\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 370,
        "y": 720,
        "wires": [
            [
                "62030521.88317c"
            ],
            [
                "d71d224f.0585d8"
            ]
        ],
        "inputLabels": [
            "direction"
        ],
        "outputLabels": [
            "message",
            "error"
        ]
    },
    {
        "id": "1962d999.4a97e6",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "stop focus",
        "group": "fbd92986.1028c8",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": true,
        "label": " STOP FOCUS",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "fa-pause fa-2x",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "actuator/focus",
        "x": 170,
        "y": 580,
        "wires": [
            [
                "62030521.88317c"
            ]
        ]
    },
    {
        "id": "62030521.88317c",
        "type": "mqtt out",
        "z": "bccd1f23.87219",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 650,
        "y": 660,
        "wires": []
    },
    {
        "id": "dbd6bde.99db64",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "round distance",
        "func": "// Here we change the focus_distance to 25 µm increment\nif (msg.payload%25 <= 12.5){\n    msg.payload = msg.payload - msg.payload%25\n}\nelse {\n    msg.payload = msg.payload + msg.payload%25\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 440,
        "wires": [
            [
                "3d31ee98.a7d6fa",
                "69d4ea6c.4c1e2c",
                "dc48dc42.98d18"
            ]
        ]
    },
    {
        "id": "3bd43039.bc5fb8",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "",
        "group": "fbd92986.1028c8",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "UP 1mm",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-angle-up fa-3x",
        "payload": "{\"action\":\"move\",\"direction\":\"UP\",\"distance\":1}",
        "payloadType": "json",
        "topic": "actuator/focus",
        "x": 180,
        "y": 620,
        "wires": [
            [
                "62030521.88317c"
            ]
        ]
    },
    {
        "id": "c0663029.2d03b",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "",
        "group": "fbd92986.1028c8",
        "order": 5,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "DOWN 1mm",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-angle-down fa-3x",
        "payload": "{\"action\":\"move\",\"direction\":\"DOWN\",\"distance\":1}",
        "payloadType": "json",
        "topic": "actuator/focus",
        "x": 170,
        "y": 660,
        "wires": [
            [
                "62030521.88317c"
            ]
        ]
    },
    {
        "id": "69d4ea6c.4c1e2c",
        "type": "ui_slider",
        "z": "bccd1f23.87219",
        "name": "focus_distance",
        "label": "",
        "tooltip": "in µm",
        "group": "fbd92986.1028c8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "focus_distance",
        "min": "25",
        "max": "2000",
        "step": "25",
        "x": 400,
        "y": 500,
        "wires": [
            [
                "3d31ee98.a7d6fa"
            ]
        ]
    },
    {
        "id": "71f55a58.d7eaf4",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: 500µm",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "500",
        "payloadType": "num",
        "x": 120,
        "y": 440,
        "wires": [
            [
                "3d31ee98.a7d6fa",
                "69d4ea6c.4c1e2c"
            ]
        ]
    },
    {
        "id": "9a1d0e7c.2d5a1",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 40,
        "wires": [
            [
                "961d27e7.da65c8"
            ]
        ]
    },
    {
        "id": "16aa0238.209276",
        "type": "ui_slider",
        "z": "bccd1f23.87219",
        "name": "Iso slider",
        "label": "ISO",
        "tooltip": "Possible values are  100, 200, 320, 400, 500, 640, 800. 500 by default.",
        "group": "8c38a81e.9897a8",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "imager/image",
        "min": "100",
        "max": "800",
        "step": "20",
        "x": 360,
        "y": 820,
        "wires": [
            [
                "bb090334.1e21a8"
            ]
        ]
    },
    {
        "id": "bb090334.1e21a8",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "round iso",
        "func": "// Iso should be one of 60, 100, 200, 320, 400, 500, 640, 800\n\nif (msg.payload <= 80){\n    msg.payload = 60;\n    return msg;\n}\n\nif (msg.payload <= 150){\n    msg.payload = 100;\n    return msg;\n}\n\nif (msg.payload <= 260){\n    msg.payload = 200;\n    return msg;\n}\n\nif (msg.payload <= 360){\n    msg.payload = 320;\n    return msg;\n}\n\nif (msg.payload <= 450){\n    msg.payload = 400;\n    return msg;\n}\n\nif (msg.payload <= 565){\n    msg.payload = 500;\n    return msg;\n}\n\nif (msg.payload <= 700){\n    msg.payload = 640;\n    return msg;\n}\n\n\nif (700 < msg.payload){\n    msg.payload = 800;\n    return msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 520,
        "y": 820,
        "wires": [
            [
                "16aa0238.209276",
                "8ea9dc9a.c7d87"
            ]
        ]
    },
    {
        "id": "8ea9dc9a.c7d87",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"iso\":msg.payload}\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 820,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "5765a825.a595c8",
        "type": "ui_slider",
        "z": "bccd1f23.87219",
        "name": "Shutter speed slider",
        "label": "Shutter Speed",
        "tooltip": "In microseconds, up to 1000µs, 1µs by default",
        "group": "8c38a81e.9897a8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "imager/image",
        "min": "1",
        "max": "1000",
        "step": "1",
        "x": 390,
        "y": 880,
        "wires": [
            [
                "c38509b.fb08af8"
            ]
        ]
    },
    {
        "id": "c38509b.fb08af8",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"shutter_speed\":msg.payload}\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 880,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "845e06e1.0d812",
        "type": "mqtt out",
        "z": "bccd1f23.87219",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 1010,
        "y": 940,
        "wires": []
    },
    {
        "id": "2350e507.d4e302",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: 1µs",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 110,
        "y": 880,
        "wires": [
            [
                "5765a825.a595c8"
            ]
        ]
    },
    {
        "id": "2edd922b.a471a6",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: ISO 100",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "100",
        "payloadType": "num",
        "x": 110,
        "y": 820,
        "wires": [
            [
                "16aa0238.209276"
            ]
        ]
    },
    {
        "id": "f782a471.447748",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: 5mL/min",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "5",
        "payloadType": "num",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "34c81624.df1cea"
            ]
        ]
    },
    {
        "id": "73b8252a.5ca754",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: 2mL",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "2",
        "payloadType": "num",
        "x": 110,
        "y": 380,
        "wires": [
            [
                "68962547.34a67c"
            ]
        ]
    },
    {
        "id": "8ec68b82.17e3d8",
        "type": "ui_button",
        "z": "cb95299c.2817c8",
        "name": "Start segmentation",
        "group": "abeb6dad.635a2",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Start segmentation",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "{\"action\":\"segment\"}",
        "payloadType": "json",
        "topic": "segmenter/segment",
        "x": 370,
        "y": 300,
        "wires": [
            [
                "33c28dc1.238002"
            ]
        ]
    },
    {
        "id": "27be7971.b3fbce",
        "type": "ui_button",
        "z": "cb95299c.2817c8",
        "name": "Stop segmentation",
        "group": "abeb6dad.635a2",
        "order": 3,
        "width": 5,
        "height": 1,
        "passthru": true,
        "label": "Stop segmentation",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "segmenter/segment",
        "x": 370,
        "y": 340,
        "wires": [
            [
                "16f3cef4.0acac9"
            ]
        ]
    },
    {
        "id": "16f3cef4.0acac9",
        "type": "mqtt out",
        "z": "cb95299c.2817c8",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 810,
        "y": 340,
        "wires": []
    },
    {
        "id": "569154a.b53182c",
        "type": "inject",
        "z": "1371dec5.76e671",
        "name": "once",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "start",
        "payloadType": "str",
        "x": 130,
        "y": 580,
        "wires": [
            [
                "452af41c.43940c",
                "b3c21aa9.8c06c"
            ]
        ]
    },
    {
        "id": "4b489713.ccde5",
        "type": "ui_button",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "group": "4322c187.e73e5",
        "order": 12,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Start Acquisition",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "camera",
        "payload": "",
        "payloadType": "str",
        "topic": "imager/image",
        "x": 520,
        "y": 580,
        "wires": [
            [
                "c9f510c0.7d1328"
            ]
        ]
    },
    {
        "id": "c9f510c0.7d1328",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "Image control",
        "func": "// Reset the number of images taken\nglobal.set('img_counter', 0);\n\nvar acq_celltype = global.get(\"acq_celltype\");\nvar acq_minimum_mesh = global.get(\"acq_minimum_mesh\");\nvar acq_maximum_mesh = global.get(\"acq_maximum_mesh\");\nvar imaging_pump_volume = global.get(\"imaging_pump_volume\");\nvar acq_id = global.get(\"acq_id\");\nvar nb_frame = global.get(\"nb_frame\");\nvar pump_direction = global.get(\"pump_direction\");\nvar sleep_before = global.get(\"sleep_before\");\n\nif (acq_celltype === undefined || acq_celltype === \"\") {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Type of the flowcell\";\n    return [null, msg];\n} else if (acq_minimum_mesh === undefined || acq_minimum_mesh === \"\") {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Lower fraction size\";\n    return [null, msg];\n} else if (acq_maximum_mesh === undefined || acq_maximum_mesh === \"\") {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Upper fraction size\";\n    return [null, msg];\n} else if (imaging_pump_volume === undefined || imaging_pump_volume === \"\" || imaging_pump_volume === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Volume inbetween images\";\n    return [null, msg];\n} else if (acq_id === undefined || acq_id === \"\") {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Acquisition ID\";\n    return [null, msg];\n} else if (nb_frame === undefined || nb_frame === \"\" || nb_frame === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Number of image to save\";\n    return [null, msg];\n} else if (pump_direction === undefined || pump_direction === \"\" || pump_direction === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Pump direction\";\n    return [null, msg];\n} else if (sleep_before === undefined || sleep_before === \"\" || pump_direction === null) {\n    msg.topic = \"Missing entry :\";\n    msg.payload = \"Delay before image\";\n    return [null, msg];\n}\nmsg.payload = {\n    \"action\": \"image\",\n    \"sleep\": sleep_before,\n    \"pump_direction\": pump_direction,\n    \"volume\": imaging_pump_volume,\n    \"nb_frame\": nb_frame,\n}\n\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 740,
        "y": 580,
        "wires": [
            [
                "52ea7d01.711034",
                "40c12463.a1f84c"
            ],
            [
                "20e0a8c8.edbeb"
            ]
        ],
        "info": "### Focusing\n##### focus.py `nb_step` `orientation`\n\n- `nb_step` : **integer** (from 1 to 100000) - number of step to perform by the stage (about 31um/step)\n- `orientation` : **string** - orientation of the focus either `up` or `down`\n\nExample:\n\n    python3.7 $HOME/PlanktonScope/scripts/focus.py 650 up\n"
    },
    {
        "id": "20e0a8c8.edbeb",
        "type": "ui_toast",
        "z": "baa1e3d9.cb29d",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 990,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "c3e50240.82aa58",
        "type": "mqtt out",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 1230,
        "y": 540,
        "wires": []
    },
    {
        "id": "3a4450b1.4459a8",
        "type": "ui_button",
        "z": "baa1e3d9.cb29d",
        "name": "Stop Acquisition",
        "group": "4322c187.e73e5",
        "order": 11,
        "width": 5,
        "height": 1,
        "passthru": true,
        "label": "STOP ACQUISITION",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "cancel",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "imager/image",
        "x": 520,
        "y": 620,
        "wires": [
            [
                "d74210ef.edc15"
            ]
        ]
    },
    {
        "id": "d74210ef.edc15",
        "type": "mqtt out",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "broker": "8dc3722c.06efa8",
        "x": 710,
        "y": 620,
        "wires": []
    },
    {
        "id": "bb62da8a.ebc328",
        "type": "ui_switch",
        "z": "baa1e3d9.cb29d",
        "name": "Pump direction",
        "label": "Pump direction",
        "tooltip": "BACKWARD / FORWARD",
        "group": "4322c187.e73e5",
        "order": 9,
        "width": 5,
        "height": 1,
        "passthru": true,
        "decouple": "false",
        "topic": "pump_direction",
        "style": "",
        "onvalue": "FORWARD",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "BACKWARD",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 520,
        "y": 660,
        "wires": [
            [
                "6b2239f3.41fa3"
            ]
        ]
    },
    {
        "id": "52ea7d01.711034",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "Encapsulate config",
        "func": "msg.payload = {\n\t\"action\": \"update_config\",\n\t\"config\": {\n\t\t\"sample_project\": global.get(\"sample_project\"),\n\t\t\"sample_id\": global.get(\"sample_id\"),\n\t\t\"sample_ship\": global.get(\"sample_ship\"),\n\t\t\"sample_operator\": global.get(\"sample_operator\"),\n\t\t\"sample_sampling_gear\": global.get(\"sample_sampling_gear\"),\n\t\t\"sample_concentrated_sample_volume\": global.get(\"sample_concentrated_sample_volume\"),\n\n\t\t\"acq_id\": global.get(\"acq_id\"),\n\t\t\"acq_instrument\": global.get(\"acq_instrument\"),\n\t\t\"acq_instrument_id\": global.get(\"acq_instrument_id\"),\n\t\t\"acq_celltype\": global.get(\"acq_celltype\"),\n\t\t\"acq_minimum_mesh\": global.get(\"acq_minimum_mesh\"),\n\t\t\"acq_maximum_mesh\": global.get(\"acq_maximum_mesh\"),\n\t\t\"acq_min_esd\": global.get(\"acq_min_esd\"),\n\t\t\"acq_max_esd\": global.get(\"acq_max_esd\"),\n\t\t\"acq_volume\": global.get(\"acq_volume\"),\n\t\t\"acq_magnification\": global.get(\"magnification\"),\n\t\t\"acq_fnumber_objective\": global.get(\"acq_fnumber_objective\"),\n\t\t\"acq_camera_name\": global.get(\"acq_camera_name\"),\n\t\t\"acq_nb_frame\": global.get(\"nb_frame\"),\n\n\t\t\"object_date\": global.get(\"object_date\"),\n\t\t\"object_time\": global.get(\"object_time\"),\n\t\t\"object_lat\": global.get(\"object_lat\"),\n\t\t\"object_lon\": global.get(\"object_lon\"),\n\t\t\"object_depth_min\": global.get(\"object_depth_min\"),\n\t\t\"object_depth_max\": global.get(\"object_depth_max\"),\n\n\t\t\"process_pixel\": global.get(\"process_pixel\"),\n\t\t\"process_id\": global.get(\"process_id\")\n\t}\n};\n\nif (msg.payload.config.sample_sampling_gear == \"net\") {\n\tmsg.payload.config = { ...msg.payload.config ,\n\t\t\t\"sample_gear_net_opening\": global.get(\"sample_gear_net_opening\"),\n\t\t\t\"object_date_end\": global.get(\"object_date_end\"),\n\t\t\t\"object_time_end\": global.get(\"object_time_end\"),\n\t\t\t\"object_lat_end\": global.get(\"object_lat_end\"),\n\t\t\t\"object_lon_end\": global.get(\"object_lon_end\")\n\t};\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 970,
        "y": 540,
        "wires": [
            [
                "c3e50240.82aa58",
                "29be525e.0c87fe"
            ]
        ]
    },
    {
        "id": "40c12463.a1f84c",
        "type": "delay",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1000,
        "y": 580,
        "wires": [
            [
                "c3e50240.82aa58"
            ]
        ]
    },
    {
        "id": "4d1b02cb.83b51c",
        "type": "ui_button",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "group": "4322c187.e73e5",
        "order": 10,
        "width": 5,
        "height": 1,
        "passthru": false,
        "label": "Update config",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "save",
        "payload": "",
        "payloadType": "str",
        "topic": "imager/image",
        "x": 520,
        "y": 540,
        "wires": [
            [
                "52ea7d01.711034",
                "a4abb1ae.2ae418"
            ]
        ]
    },
    {
        "id": "452af41c.43940c",
        "type": "python3-function",
        "z": "1371dec5.76e671",
        "name": "Get MachineName",
        "func": "import sys\nsys.path.append('/home/pi/PlanktonScope/scripts')\nimport planktoscope.uuidName\n\nmsg['payload'] = planktoscope.uuidName.machineName(machine=planktoscope.uuidName.getSerial())\nmsg['topic'] = \"acq_instrument_id\";\nreturn msg",
        "outputs": 1,
        "x": 350,
        "y": 620,
        "wires": [
            [
                "4828d2f4.7c712c",
                "a400a97e.e333a8"
            ]
        ]
    },
    {
        "id": "4828d2f4.7c712c",
        "type": "function",
        "z": "1371dec5.76e671",
        "name": "set global",
        "func": "global.set(msg.topic,msg.payload);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 580,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "d027a6bf.7049e8",
        "type": "function",
        "z": "b771c342.49603",
        "name": "get sample_projet",
        "func": "msg.payload = msg.payload.sample_project;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 330,
        "y": 300,
        "wires": [
            [
                "9c882b37.fde668"
            ]
        ]
    },
    {
        "id": "5a811caf.0f3144",
        "type": "function",
        "z": "b771c342.49603",
        "name": "get sample_ship",
        "func": "msg.payload = msg.payload.sample_ship;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 330,
        "y": 340,
        "wires": [
            [
                "4557d689.a4fa88"
            ]
        ]
    },
    {
        "id": "45911c98.2bd83c",
        "type": "function",
        "z": "b771c342.49603",
        "name": "get sample_id",
        "func": "msg.payload = msg.payload.sample_id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 320,
        "y": 380,
        "wires": [
            [
                "94eb4221.9b92c"
            ]
        ]
    },
    {
        "id": "1e09a4ab.72996b",
        "type": "function",
        "z": "b771c342.49603",
        "name": "get sample_operator",
        "func": "msg.payload = msg.payload.sample_operator;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 340,
        "y": 420,
        "wires": [
            [
                "82c5fc77.59c97"
            ]
        ]
    },
    {
        "id": "a3272681.f271c8",
        "type": "function",
        "z": "b771c342.49603",
        "name": "get sample_sampling_gear",
        "func": "msg.payload = msg.payload.sample_sampling_gear;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 360,
        "y": 460,
        "wires": [
            [
                "fcfc31ae.af3af"
            ]
        ]
    },
    {
        "id": "6465bdd5.15eb8c",
        "type": "file in",
        "z": "1c24ad9c.bebec2",
        "name": "",
        "filename": "/home/pi/PlanktonScope/config.json",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "x": 660,
        "y": 300,
        "wires": [
            [
                "15ceb135.6628bf"
            ]
        ],
        "info": "# PlanktonScope Help\nThis Node will read the content of the file named **config.txt** containing all the input placeholders.\n"
    },
    {
        "id": "15ceb135.6628bf",
        "type": "json",
        "z": "1c24ad9c.bebec2",
        "name": "config.json",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 910,
        "y": 300,
        "wires": [
            [
                "ad541674.4791c8"
            ]
        ]
    },
    {
        "id": "7205d267.36adcc",
        "type": "file",
        "z": "1c24ad9c.bebec2",
        "name": "",
        "filename": "/home/pi/PlanktonScope/config.json",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 1040,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "2e6ddf51.c0dba",
        "type": "json",
        "z": "1c24ad9c.bebec2",
        "name": "config.json",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 790,
        "y": 860,
        "wires": [
            [
                "7205d267.36adcc"
            ]
        ]
    },
    {
        "id": "ad541674.4791c8",
        "type": "function",
        "z": "1c24ad9c.bebec2",
        "name": "Global Set",
        "func": "for (const key in msg.payload) {\n    global.set(key, msg.payload[key]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1090,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "3e9a33c.141384c",
        "type": "inject",
        "z": "1c24ad9c.bebec2",
        "name": "Load config",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 410,
        "y": 300,
        "wires": [
            [
                "6465bdd5.15eb8c"
            ]
        ]
    },
    {
        "id": "e2f39a35.f57298",
        "type": "subflow:1c24ad9c.bebec2",
        "z": "1371dec5.76e671",
        "name": "",
        "env": [],
        "x": 570,
        "y": 560,
        "wires": [
            [
                "bdc6718a.dd5d48"
            ]
        ]
    },
    {
        "id": "a6907a38.f6611",
        "type": "subflow:1c24ad9c.bebec2",
        "z": "b771c342.49603",
        "name": "",
        "env": [],
        "x": 90,
        "y": 380,
        "wires": [
            [
                "d027a6bf.7049e8",
                "5a811caf.0f3144",
                "45911c98.2bd83c",
                "1e09a4ab.72996b",
                "a3272681.f271c8"
            ]
        ]
    },
    {
        "id": "e2b277c1.07283",
        "type": "subflow:1c24ad9c.bebec2",
        "z": "b771c342.49603",
        "name": "",
        "env": [],
        "x": 750,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "3cea1f2.20525e",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_lat_end",
        "label": "Latitude",
        "tooltip": "36.5794° N",
        "group": "cf5d9f0e.d57e7",
        "order": 8,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "object_lat_end",
        "x": 600,
        "y": 940,
        "wires": [
            [
                "7953b1b2.d53ed8"
            ]
        ]
    },
    {
        "id": "661818e.5a31368",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_lon_end",
        "label": "Longitude",
        "tooltip": "110.421° W",
        "group": "cf5d9f0e.d57e7",
        "order": 9,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "object_lon_end",
        "x": 600,
        "y": 980,
        "wires": [
            [
                "7953b1b2.d53ed8"
            ]
        ]
    },
    {
        "id": "f9d71e4b.2940a",
        "type": "ui_date_picker",
        "z": "b771c342.49603",
        "name": "object_date_end",
        "label": "Date",
        "group": "cf5d9f0e.d57e7",
        "order": 10,
        "width": 5,
        "height": 1,
        "passthru": true,
        "topic": "object_date_end",
        "x": 1230,
        "y": 940,
        "wires": [
            [
                "29f2b365.4327ec"
            ]
        ]
    },
    {
        "id": "2a514f3b.97a6b",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_time_end",
        "label": "Time",
        "tooltip": "UTC time, 03:23:00 or 15:45",
        "group": "cf5d9f0e.d57e7",
        "order": 11,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "object_time_end",
        "x": 1230,
        "y": 980,
        "wires": [
            [
                "1a945afa.d60aad"
            ]
        ]
    },
    {
        "id": "1a945afa.d60aad",
        "type": "function",
        "z": "b771c342.49603",
        "name": "set time global",
        "func": "msg.payload = msg.payload.replace(/\\D/g, \"\"); // remove non-digit characters\nif (msg.payload.length<5) msg.payload += \"00\";\n\nglobal.set(msg.topic,msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1540,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "29f2b365.4327ec",
        "type": "function",
        "z": "b771c342.49603",
        "name": "set date global",
        "func": "var date = new Date(msg.payload);\n\nglobal.set(msg.topic,date.toISOString().split('T')[0].replace(/-/gi, ''));",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1540,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "b3c21aa9.8c06c",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "git --git-dir /home/pi/PlanktonScope/.git/ rev-parse --short master",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "git rev",
        "x": 310,
        "y": 540,
        "wires": [
            [
                "3e64877a.9684b"
            ],
            [],
            []
        ]
    },
    {
        "id": "3e64877a.9684b",
        "type": "function",
        "z": "1371dec5.76e671",
        "name": "store version",
        "func": "msg.payload = \"PlanktoScope v2.2-\"+msg.payload.trim()\n\nglobal.set(\"acq_software\",msg.payload);\n\nreturn msg\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 520,
        "wires": [
            [
                "8343fa69.49339"
            ]
        ]
    },
    {
        "id": "68fa1227.dbdd5c",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "get acq_fnumber_objective",
        "func": "msg.payload = msg.payload.acq_fnumber_objective;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 920,
        "y": 140,
        "wires": [
            [
                "cc966678.da8d08"
            ]
        ]
    },
    {
        "id": "1c45ea1c.80234e",
        "type": "subflow:1c24ad9c.bebec2",
        "z": "bccd1f23.87219",
        "name": "",
        "x": 720,
        "y": 140,
        "wires": [
            [
                "68fa1227.dbdd5c"
            ]
        ]
    },
    {
        "id": "5921d0d0.a3d568",
        "type": "subflow:1c24ad9c.bebec2",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "env": [],
        "x": 90,
        "y": 180,
        "wires": [
            [
                "f3658d30.b8448",
                "d3ca8847.4d1ae",
                "5e3dec55.881074",
                "de2c90cf.b73b08"
            ]
        ]
    },
    {
        "id": "f3658d30.b8448",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "get acq_id",
        "func": "msg.payload = msg.payload.acq_id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 310,
        "y": 240,
        "wires": [
            [
                "6b34c456.83178c"
            ]
        ]
    },
    {
        "id": "de2c90cf.b73b08",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "get acq_celltype",
        "func": "msg.payload = msg.payload.acq_celltype;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 320,
        "y": 200,
        "wires": [
            [
                "cc0ca68b.4263a8"
            ]
        ]
    },
    {
        "id": "5e3dec55.881074",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "get acq_minimum_mesh",
        "func": "msg.payload = msg.payload.acq_minimum_mesh;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 120,
        "wires": [
            [
                "f59a2f0d.5e9af"
            ]
        ]
    },
    {
        "id": "d3ca8847.4d1ae",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "get acq_maximum_mesh",
        "func": "msg.payload = msg.payload.acq_maximum_mesh;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 350,
        "y": 160,
        "wires": [
            [
                "6008a8bb.259f08"
            ]
        ]
    },
    {
        "id": "bdc6718a.dd5d48",
        "type": "ui_text",
        "z": "1371dec5.76e671",
        "group": "ce9e278.781eed8",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Instrument Type",
        "format": "{{msg.payload.acq_instrument}}",
        "layout": "row-spread",
        "x": 840,
        "y": 560,
        "wires": []
    },
    {
        "id": "a400a97e.e333a8",
        "type": "ui_text",
        "z": "1371dec5.76e671",
        "group": "ce9e278.781eed8",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Instrument Name",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 610,
        "y": 600,
        "wires": []
    },
    {
        "id": "8343fa69.49339",
        "type": "ui_text",
        "z": "1371dec5.76e671",
        "group": "ce9e278.781eed8",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Software version",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 840,
        "y": 520,
        "wires": []
    },
    {
        "id": "f783aefd.c3bfd8",
        "type": "ui_text",
        "z": "1371dec5.76e671",
        "group": "ce9e278.781eed8",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Camera Name",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "x": 1020,
        "y": 620,
        "wires": []
    },
    {
        "id": "906d9fea.4bab48",
        "type": "status",
        "z": "b771c342.49603",
        "d": true,
        "name": "GPS Status",
        "scope": [],
        "x": 310,
        "y": 1500,
        "wires": [
            [
                "7116e906.9f50f"
            ]
        ]
    },
    {
        "id": "7116e906.9f50f",
        "type": "ui_text",
        "z": "b771c342.49603",
        "d": true,
        "group": "cf5d9f0e.d57e7",
        "order": 12,
        "width": 6,
        "height": 1,
        "name": "GPS Status Display",
        "label": "GPS Status:",
        "format": "{{msg.status.text}}",
        "layout": "row-left",
        "x": 810,
        "y": 1500,
        "wires": []
    },
    {
        "id": "48879182.6fd718",
        "type": "inject",
        "z": "baa1e3d9.cb29d",
        "name": "Default: 100",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "100",
        "payloadType": "num",
        "x": 310,
        "y": 280,
        "wires": [
            [
                "51b4d0df.d70a88"
            ]
        ]
    },
    {
        "id": "6451f991.aaac1",
        "type": "ui_button",
        "z": "bccd1f23.87219",
        "name": "stop pump",
        "group": "707d9797.c8e798",
        "order": 5,
        "width": 3,
        "height": 1,
        "passthru": true,
        "label": " STOP PUMP",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "fa-pause fa-2x",
        "payload": "{\"action\":\"stop\"}",
        "payloadType": "json",
        "topic": "actuator/pump",
        "x": 170,
        "y": 180,
        "wires": [
            [
                "bdc8ce57.de1f08"
            ]
        ]
    },
    {
        "id": "b402f719.55bc98",
        "type": "inject",
        "z": "baa1e3d9.cb29d",
        "name": "Default: FORWARD",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "pump_direction",
        "payload": "FORWARD",
        "payloadType": "str",
        "x": 280,
        "y": 660,
        "wires": [
            [
                "bb62da8a.ebc328"
            ]
        ]
    },
    {
        "id": "6b2239f3.41fa3",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "set global",
        "func": "global.set(msg.topic, msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "51b4d0df.d70a88",
        "type": "ui_text_input",
        "z": "baa1e3d9.cb29d",
        "name": "nb_frame",
        "label": "Number of images to acquire",
        "tooltip": "",
        "group": "4322c187.e73e5",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": 300,
        "topic": "nb_frame",
        "x": 640,
        "y": 280,
        "wires": [
            [
                "fb887036.12429",
                "67091ac0.8f9f6c",
                "99b11fe4.2795d"
            ]
        ]
    },
    {
        "id": "9c7f7fc9.c8d3a",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_depth_max",
        "label": "Object depth Max",
        "tooltip": "",
        "group": "3e1ba03d.f01d8",
        "order": 7,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": "1000",
        "topic": "object_depth_max",
        "x": 650,
        "y": 540,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "317eeeb7.8d3042",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_depth_min",
        "label": "Object Depth Min",
        "tooltip": "",
        "group": "3e1ba03d.f01d8",
        "order": 6,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": "1000",
        "topic": "object_depth_min",
        "x": 650,
        "y": 580,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "999065ca.27edb8",
        "type": "switch",
        "z": "baa1e3d9.cb29d",
        "name": "topic filter",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "status/pump",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/focus",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/imager",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 660,
        "y": 940,
        "wires": [
            [
                "a46a1e7f.88a92",
                "6742014e.1bb238"
            ],
            [
                "c516d9ea.f7f6e",
                "6742014e.1bb238"
            ],
            [
                "307c851e.fb0f7a",
                "2b9d6988.d84836"
            ]
        ]
    },
    {
        "id": "2b009bd7.c07004",
        "type": "ui_text",
        "z": "baa1e3d9.cb29d",
        "group": "70de8209.68416c",
        "order": 3,
        "width": 10,
        "height": 2,
        "name": "imager",
        "label": "Imager status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 1110,
        "y": 880,
        "wires": []
    },
    {
        "id": "c516d9ea.f7f6e",
        "type": "ui_text",
        "z": "baa1e3d9.cb29d",
        "group": "70de8209.68416c",
        "order": 1,
        "width": 5,
        "height": 1,
        "name": "focus",
        "label": "Focus status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 1110,
        "y": 840,
        "wires": []
    },
    {
        "id": "a46a1e7f.88a92",
        "type": "ui_text",
        "z": "baa1e3d9.cb29d",
        "group": "70de8209.68416c",
        "order": 2,
        "width": 5,
        "height": 1,
        "name": "pump",
        "label": "Pump status:",
        "format": "{{msg.payload.status}}",
        "layout": "col-center",
        "x": 1110,
        "y": 800,
        "wires": []
    },
    {
        "id": "bb628f8d.98f108",
        "type": "link in",
        "z": "baa1e3d9.cb29d",
        "name": "Status for fluidic module",
        "links": [
            "58f2e0f.4e8b12"
        ],
        "x": 515,
        "y": 940,
        "wires": [
            [
                "999065ca.27edb8"
            ]
        ]
    },
    {
        "id": "1fdf77b5.24e4e",
        "type": "mqtt in",
        "z": "9a22e67a.378818",
        "name": "",
        "topic": "status/#",
        "qos": "0",
        "datatype": "json",
        "broker": "8dc3722c.06efa8",
        "x": 290,
        "y": 340,
        "wires": [
            [
                "fa73983d.318188"
            ]
        ]
    },
    {
        "id": "4a1e9e3e.27506",
        "type": "switch",
        "z": "9a22e67a.378818",
        "name": "Filter segmenter out",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            },
            {
                "t": "cont",
                "v": "status/segmenter",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 620,
        "y": 340,
        "wires": [
            [
                "58f2e0f.4e8b12"
            ],
            [
                "dcf5bd45.16a8d"
            ]
        ]
    },
    {
        "id": "fa73983d.318188",
        "type": "json",
        "z": "9a22e67a.378818",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": true,
        "x": 430,
        "y": 340,
        "wires": [
            [
                "4a1e9e3e.27506"
            ]
        ]
    },
    {
        "id": "58f2e0f.4e8b12",
        "type": "link out",
        "z": "9a22e67a.378818",
        "name": "Fluidic module status",
        "links": [
            "bb628f8d.98f108"
        ],
        "x": 795,
        "y": 320,
        "wires": []
    },
    {
        "id": "307c851e.fb0f7a",
        "type": "switch",
        "z": "baa1e3d9.cb29d",
        "name": "Imaging state",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "$contains(msg.payload.status, \"jpg\")\t",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 890,
        "y": 1040,
        "wires": [
            [
                "db8e3dde.44efb8"
            ],
            [
                "6742014e.1bb238"
            ]
        ]
    },
    {
        "id": "db8e3dde.44efb8",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "img_counter.js",
        "func": "img_counter=global.get('img_counter')\nimg_counter=img_counter+1\nglobal.set('img_counter',img_counter)\nmsg.payload = img_counter\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1140,
        "y": 1080,
        "wires": [
            [
                "39812a27.6cb10e"
            ]
        ]
    },
    {
        "id": "59164d65.e7993c",
        "type": "ui_toast",
        "z": "baa1e3d9.cb29d",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 1600,
        "y": 980,
        "wires": []
    },
    {
        "id": "8c7348aa.1962e8",
        "type": "template",
        "z": "baa1e3d9.cb29d",
        "name": "Create sentence",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "The {{topic}} is {{payload.status}}",
        "output": "str",
        "x": 1400,
        "y": 980,
        "wires": [
            [
                "59164d65.e7993c"
            ]
        ]
    },
    {
        "id": "6742014e.1bb238",
        "type": "change",
        "z": "baa1e3d9.cb29d",
        "name": "Remove high-level topic",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "status/",
                "fromt": "str",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 980,
        "wires": [
            [
                "8c7348aa.1962e8"
            ]
        ]
    },
    {
        "id": "1a2e721a.f5e876",
        "type": "ui_gauge",
        "z": "baa1e3d9.cb29d",
        "name": "progress donut",
        "group": "b5d61bc7.54fe48",
        "order": 3,
        "width": 6,
        "height": 3,
        "gtype": "donut",
        "title": "",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#ffa83f",
            "#e6ff02",
            "#00dfe9"
        ],
        "seg1": "50",
        "seg2": "75",
        "x": 1600,
        "y": 1080,
        "wires": []
    },
    {
        "id": "39812a27.6cb10e",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "percent image",
        "func": "msg.payload = (100 * msg.payload/global.get('nb_frame')).toFixed(2)\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1380,
        "y": 1080,
        "wires": [
            [
                "1a2e721a.f5e876"
            ]
        ]
    },
    {
        "id": "8f3788f6.ddcf98",
        "type": "function",
        "z": "cb95299c.2817c8",
        "name": "obj_counter.js",
        "func": "obj_counter=global.get('obj_counter')\nobj_counter=obj_counter+1\nglobal.set('obj_counter',obj_counter)\nmsg.payload = obj_counter\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 820,
        "y": 840,
        "wires": [
            [
                "9d53dbe2.dbffe8",
                "fa3b7929.ac7da8"
            ]
        ]
    },
    {
        "id": "aa38dbbc.cf0a9",
        "type": "switch",
        "z": "cb95299c.2817c8",
        "name": "Segmenter",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "status/segmenter",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/segmenter/name",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/segmenter/object_id",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "status/segmenter/metric",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 490,
        "y": 740,
        "wires": [
            [
                "b9a23b91.93638",
                "6919465f.332e5"
            ],
            [
                "49af3d24.1799e4"
            ],
            [
                "8f3788f6.ddcf98"
            ],
            [
                "50ce901f.b5034"
            ]
        ]
    },
    {
        "id": "9d53dbe2.dbffe8",
        "type": "ui_chart",
        "z": "cb95299c.2817c8",
        "name": "counter graph",
        "group": "46be9c86.dea684",
        "order": 6,
        "width": 10,
        "height": 2,
        "label": "",
        "chartType": "horizontalBar",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Objects count will be shown here once the segmentation is started",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": true,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1340,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "50ce901f.b5034",
        "type": "function",
        "z": "cb95299c.2817c8",
        "name": "ex : area",
        "func": "msg.payload=msg.payload.object_area\nmsg.topic=\"area\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 800,
        "y": 920,
        "wires": [
            [
                "458cd82e.03d258"
            ]
        ]
    },
    {
        "id": "a4f0f0d1.3aca88",
        "type": "ui_toast",
        "z": "cb95299c.2817c8",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 1340,
        "y": 680,
        "wires": []
    },
    {
        "id": "458cd82e.03d258",
        "type": "ui_chart",
        "z": "cb95299c.2817c8",
        "name": "Area chart",
        "group": "46be9c86.dea684",
        "order": 9,
        "width": 10,
        "height": 6,
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "Objects area will be shown here once the segmentation is started",
        "dot": true,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "1000",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": true,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1320,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "49af3d24.1799e4",
        "type": "debug",
        "z": "cb95299c.2817c8",
        "name": "segmentation name",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 840,
        "y": 760,
        "wires": []
    },
    {
        "id": "7088a5be.0c79a4",
        "type": "template",
        "z": "cb95299c.2817c8",
        "name": "Create sentence",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "The {{topic}} is {{payload.status}}",
        "output": "str",
        "x": 1100,
        "y": 680,
        "wires": [
            [
                "a4f0f0d1.3aca88"
            ]
        ]
    },
    {
        "id": "b9a23b91.93638",
        "type": "change",
        "z": "cb95299c.2817c8",
        "name": "Remove high-level topic",
        "rules": [
            {
                "t": "change",
                "p": "topic",
                "pt": "msg",
                "from": "status/",
                "fromt": "str",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 680,
        "wires": [
            [
                "7088a5be.0c79a4"
            ]
        ]
    },
    {
        "id": "6919465f.332e5",
        "type": "ui_text",
        "z": "cb95299c.2817c8",
        "group": "46be9c86.dea684",
        "order": 1,
        "width": 10,
        "height": 1,
        "name": "segmenter",
        "label": "Segmenter status:",
        "format": "{{msg.payload.status}}",
        "layout": "row-spread",
        "x": 810,
        "y": 720,
        "wires": []
    },
    {
        "id": "fa3b7929.ac7da8",
        "type": "ui_text",
        "z": "cb95299c.2817c8",
        "group": "46be9c86.dea684",
        "order": 4,
        "width": 4,
        "height": 1,
        "name": "counter",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 1320,
        "y": 800,
        "wires": []
    },
    {
        "id": "640ece83.88cab",
        "type": "inject",
        "z": "cb95299c.2817c8",
        "name": "Init graphs",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0",
        "payloadType": "num",
        "x": 810,
        "y": 800,
        "wires": [
            [
                "cd10a556.6a9a08"
            ]
        ]
    },
    {
        "id": "cd10a556.6a9a08",
        "type": "function",
        "z": "cb95299c.2817c8",
        "name": "obj_counter init",
        "func": "obj_counter=0\nglobal.set('obj_counter',obj_counter)\nmsg.payload = obj_counter\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1000,
        "y": 800,
        "wires": [
            [
                "fa3b7929.ac7da8"
            ]
        ]
    },
    {
        "id": "25867454.a8e334",
        "type": "link in",
        "z": "cb95299c.2817c8",
        "name": "Segmenter module status",
        "links": [
            "dcf5bd45.16a8d"
        ],
        "x": 295,
        "y": 740,
        "wires": [
            [
                "aa38dbbc.cf0a9"
            ]
        ]
    },
    {
        "id": "dcf5bd45.16a8d",
        "type": "link out",
        "z": "9a22e67a.378818",
        "name": "Segmenter module status",
        "links": [
            "25867454.a8e334"
        ],
        "x": 795,
        "y": 360,
        "wires": []
    },
    {
        "id": "52af9ac0.60eb24",
        "type": "link out",
        "z": "b771c342.49603",
        "name": "Sample Operator",
        "links": [
            "c1d4934c.9bb628",
            "35eb925e.5f8016"
        ],
        "x": 815,
        "y": 420,
        "wires": []
    },
    {
        "id": "9bd72495.a8a098",
        "type": "ui_text",
        "z": "baa1e3d9.cb29d",
        "group": "4322c187.e73e5",
        "order": 5,
        "width": 5,
        "height": 1,
        "name": "Total imaged volume",
        "label": "Total imaged volume",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 1180,
        "y": 240,
        "wires": []
    },
    {
        "id": "99b11fe4.2795d",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "imaged volume calc",
        "func": "camera = global.get(\"acq_camera\");\ncell = global.get(\"acq_celltype\");\nnb_frame = global.get(\"nb_frame\");\n\nif (camera == \"HQ Camera\"){\n    volume = nb_frame * (4.15*3.14*cell/1000) / 1000;\n}\nelse if (camera == \"Camera v2.1\"){\n    volume = nb_frame * (2.31*1.74*cell/1000) / 1000;\n}\nelse{\n    msg.payload = \"The camera is not known to this system\";\n    return msg;\n}\n\nglobal.set(\"acq_imaged_volume\", volume.toFixed(4))\n\nmsg.payload = volume.toFixed(2) + \" mL\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 940,
        "y": 240,
        "wires": [
            [
                "9bd72495.a8a098"
            ]
        ],
        "info": "### Focusing\n##### focus.py `nb_step` `orientation`\n\n- `nb_step` : **integer** (from 1 to 100000) - number of step to perform by the stage (about 31um/step)\n- `orientation` : **string** - orientation of the focus either `up` or `down`\n\nExample:\n\n    python3.7 $HOME/PlanktonScope/scripts/focus.py 650 up\n"
    },
    {
        "id": "8e16aa2f.e40398",
        "type": "ui_text",
        "z": "baa1e3d9.cb29d",
        "group": "4322c187.e73e5",
        "order": 7,
        "width": 5,
        "height": 1,
        "name": "Total pumped volume",
        "label": "Total pumped volume",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 1180,
        "y": 300,
        "wires": []
    },
    {
        "id": "67091ac0.8f9f6c",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "acq_volume calc",
        "func": "var imaging_pump_volume = global.get(\"imaging_pump_volume\");\nvar nb_frame = global.get(\"nb_frame\");\n\nvar acq_volume =  (Number(nb_frame)*Number(imaging_pump_volume)).toFixed(2)\nglobal.set(\"acq_volume\", acq_volume)\n\nmsg.payload = acq_volume + \" mL\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 930,
        "y": 300,
        "wires": [
            [
                "8e16aa2f.e40398"
            ]
        ],
        "info": "### Focusing\n##### focus.py `nb_step` `orientation`\n\n- `nb_step` : **integer** (from 1 to 100000) - number of step to perform by the stage (about 31um/step)\n- `orientation` : **string** - orientation of the focus either `up` or `down`\n\nExample:\n\n    python3.7 $HOME/PlanktonScope/scripts/focus.py 650 up\n"
    },
    {
        "id": "43737d43.eb0e9c",
        "type": "ui_slider",
        "z": "bccd1f23.87219",
        "name": "WB Red slider",
        "label": "WB: Red",
        "tooltip": "from 1.0 to 8.0",
        "group": "8c38a81e.9897a8",
        "order": 4,
        "width": 8,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "imager/image",
        "min": "1.0",
        "max": "8.0",
        "step": "0.01",
        "x": 380,
        "y": 940,
        "wires": [
            [
                "5e147425.7666ec"
            ]
        ]
    },
    {
        "id": "5e147425.7666ec",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"white_balance_gain\":{\n        \"red\":Math.round(msg.payload*100)\n        }\n    }\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 940,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "4b708426.adeeb4",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"white_balance_gain\":{\n        \"blue\":Math.round(msg.payload*100)\n        }\n    }\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 1000,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "5ca6cdb6.3a6684",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: WB 2.0",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "2.0",
        "payloadType": "num",
        "x": 120,
        "y": 940,
        "wires": [
            [
                "43737d43.eb0e9c"
            ]
        ]
    },
    {
        "id": "7b699798.3d568",
        "type": "ui_slider",
        "z": "bccd1f23.87219",
        "name": "WB Blue slider",
        "label": "WB: Blue",
        "tooltip": "from 1.0 to 8.0",
        "group": "8c38a81e.9897a8",
        "order": 5,
        "width": 8,
        "height": 1,
        "passthru": true,
        "outs": "end",
        "topic": "imager/image",
        "min": "1.0",
        "max": "8.0",
        "step": "0.01",
        "x": 380,
        "y": 1000,
        "wires": [
            [
                "4b708426.adeeb4"
            ]
        ]
    },
    {
        "id": "7db56b9d.37f52c",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: WB 1.4",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "1.4",
        "payloadType": "num",
        "x": 120,
        "y": 1000,
        "wires": [
            [
                "7b699798.3d568"
            ]
        ]
    },
    {
        "id": "daedda1b.9805b8",
        "type": "function",
        "z": "bccd1f23.87219",
        "name": "Encapsulate settings",
        "func": "msg.payload = {\n    \"action\":\"settings\", \n    \"settings\":{\"white_balance\":msg.payload}\n}\nmsg.topic = \"imager/image\"\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 720,
        "y": 1060,
        "wires": [
            [
                "845e06e1.0d812"
            ]
        ]
    },
    {
        "id": "82722a3c.846b3",
        "type": "inject",
        "z": "bccd1f23.87219",
        "name": "Default: OFF",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payload": "false",
        "payloadType": "bool",
        "x": 110,
        "y": 1060,
        "wires": [
            [
                "60e44330.50bdec"
            ]
        ]
    },
    {
        "id": "60e44330.50bdec",
        "type": "ui_switch",
        "z": "bccd1f23.87219",
        "name": "AWB",
        "label": "Auto White Balance",
        "tooltip": "",
        "group": "8c38a81e.9897a8",
        "order": 3,
        "width": 2,
        "height": 2,
        "passthru": true,
        "decouple": "false",
        "topic": "imager/image",
        "style": "",
        "onvalue": "auto",
        "onvalueType": "str",
        "onicon": "",
        "oncolor": "",
        "offvalue": "off",
        "offvalueType": "str",
        "officon": "",
        "offcolor": "",
        "x": 410,
        "y": 1060,
        "wires": [
            [
                "daedda1b.9805b8"
            ]
        ]
    },
    {
        "id": "2b9d6988.d84836",
        "type": "switch",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "status",
                "vt": "str"
            },
            {
                "t": "hask",
                "v": "camera_name",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 990,
        "y": 900,
        "wires": [
            [
                "2b009bd7.c07004"
            ],
            [
                "3bbb756a.84190a"
            ]
        ]
    },
    {
        "id": "3bbb756a.84190a",
        "type": "function",
        "z": "baa1e3d9.cb29d",
        "name": "set camera name",
        "func": "global.set(\"acq_camera\", msg.payload.camera_name);\n\nmsg.payload = msg.payload.camera_name;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1150,
        "y": 920,
        "wires": [
            [
                "559a8085.1d6b9"
            ]
        ]
    },
    {
        "id": "559a8085.1d6b9",
        "type": "link out",
        "z": "baa1e3d9.cb29d",
        "name": "Camera Name",
        "links": [
            "30067f35.532f2",
            "572a6daa.6004c4",
            "cfc783d7.d6ceb"
        ],
        "x": 1305,
        "y": 920,
        "wires": []
    },
    {
        "id": "30067f35.532f2",
        "type": "link in",
        "z": "1371dec5.76e671",
        "name": "Camera Name",
        "links": [
            "559a8085.1d6b9"
        ],
        "x": 875,
        "y": 620,
        "wires": [
            [
                "f783aefd.c3bfd8"
            ]
        ]
    },
    {
        "id": "11b51f8f.acd308",
        "type": "python3-function",
        "z": "1371dec5.76e671",
        "d": true,
        "name": "fan temperature",
        "func": "import smbus\nbus = smbus.SMBus(1)\n\naddr = 0x0d\nfan_reg = 0x08\n\ntemp = float( msg[\"payload\"])\n\n# 0x01 full speed, 0x02: 20% speed, ..., 0x09: 90% speed\n\nif temp < 38:\n    bus.write_byte_data(addr, fan_reg, 0x00)\nelif temp < 43:\n    bus.write_byte_data(addr, fan_reg, 0x02)\nelif temp < 46:\n    bus.write_byte_data(addr, fan_reg, 0x04)\nelif temp < 48:\n    bus.write_byte_data(addr, fan_reg, 0x06)\nelif temp < 52:\n    bus.write_byte_data(addr, fan_reg, 0x08)\nelse:\n    bus.write_byte_data(addr, fan_reg, 0x01)\n\nreturn msg",
        "outputs": 1,
        "x": 1520,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "d7c68899.f8f678",
        "type": "switch",
        "z": "b771c342.49603",
        "name": "Check if net",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "net",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1090,
        "y": 420,
        "wires": [
            [
                "66b362ee.80b5b4"
            ],
            [
                "399cb596.1eaf1a"
            ]
        ]
    },
    {
        "id": "66b362ee.80b5b4",
        "type": "change",
        "z": "b771c342.49603",
        "name": "Activate Net group",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"show\":[\"Sample_Net_Metadata\"],\"hide\":[\"Sample_Sample_Location\"]}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1290,
        "y": 400,
        "wires": [
            [
                "cbb123ab.fd3428"
            ]
        ]
    },
    {
        "id": "399cb596.1eaf1a",
        "type": "change",
        "z": "b771c342.49603",
        "name": "Deactivate Net group",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"group\":{\"hide\":[\"Sample_Net_Metadata\"],\"show\":[\"Sample_Sample_Location\"]}}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1300,
        "y": 440,
        "wires": [
            [
                "cbb123ab.fd3428"
            ]
        ]
    },
    {
        "id": "cbb123ab.fd3428",
        "type": "ui_ui_control",
        "z": "b771c342.49603",
        "name": "",
        "events": "change",
        "x": 1500,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "a3b44a65.2d125",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_lat",
        "label": "Latitude",
        "tooltip": "36.5794° N",
        "group": "cef1e703.bcf3c8",
        "order": 1,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "object_lat",
        "x": 620,
        "y": 700,
        "wires": [
            [
                "7953b1b2.d53ed8"
            ]
        ]
    },
    {
        "id": "d285b897.2ef578",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_lon",
        "label": "Longitude",
        "tooltip": "110.421° W",
        "group": "cef1e703.bcf3c8",
        "order": 2,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": "1000",
        "topic": "object_lon",
        "x": 610,
        "y": 740,
        "wires": [
            [
                "7953b1b2.d53ed8"
            ]
        ]
    },
    {
        "id": "6212dc39.bc143c",
        "type": "ui_date_picker",
        "z": "b771c342.49603",
        "name": "object_date",
        "label": "Date",
        "group": "cef1e703.bcf3c8",
        "order": 3,
        "width": 5,
        "height": 1,
        "passthru": true,
        "topic": "object_date",
        "x": 1250,
        "y": 700,
        "wires": [
            [
                "29f2b365.4327ec"
            ]
        ]
    },
    {
        "id": "8a13b675.d7851",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "object_time",
        "label": "Time",
        "tooltip": "UTC time, 03:23:00 or 15:45",
        "group": "cef1e703.bcf3c8",
        "order": 4,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "text",
        "delay": 300,
        "topic": "object_time",
        "x": 1250,
        "y": 740,
        "wires": [
            [
                "1a945afa.d60aad"
            ]
        ]
    },
    {
        "id": "31c13820.0e52f",
        "type": "ui_template",
        "z": "b771c342.49603",
        "group": "cf5d9f0e.d57e7",
        "name": "Net throw location",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<div><h3>Net throw location</h3></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 590,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "b21d9c96.66f2f8",
        "type": "ui_template",
        "z": "b771c342.49603",
        "group": "cf5d9f0e.d57e7",
        "name": "Net throw retrieval",
        "order": 7,
        "width": 0,
        "height": 0,
        "format": "<div><h3>Net throw retrieval</h3></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 590,
        "y": 900,
        "wires": [
            []
        ]
    },
    {
        "id": "b0081852.be553",
        "type": "inject",
        "z": "cb95299c.2817c8",
        "name": "Default process_id: 1",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "process_id",
        "payload": "1",
        "payloadType": "num",
        "x": 360,
        "y": 200,
        "wires": [
            [
                "c8749cbb.55254"
            ]
        ]
    },
    {
        "id": "c8749cbb.55254",
        "type": "function",
        "z": "cb95299c.2817c8",
        "name": "set global",
        "func": "global.set(msg.topic, msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 560,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "d43c3ed9.e6cb1",
        "type": "ui_template",
        "z": "cb95299c.2817c8",
        "group": "46be9c86.dea684",
        "name": "Object counts",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<div><center><h2>Object counts</h2></center></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1340,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "857e90c1.cd25b",
        "type": "ui_template",
        "z": "cb95299c.2817c8",
        "group": "46be9c86.dea684",
        "name": "Area chart",
        "order": 8,
        "width": 0,
        "height": 0,
        "format": "<div><center><h2>Area chart</h2></center></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 1320,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "a8bf2334.279c",
        "type": "inject",
        "z": "baa1e3d9.cb29d",
        "name": "Default: 0.5",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "0.5",
        "payloadType": "num",
        "x": 310,
        "y": 80,
        "wires": [
            [
                "49ea1123.ee1768"
            ]
        ]
    },
    {
        "id": "49ea1123.ee1768",
        "type": "ui_numeric",
        "z": "baa1e3d9.cb29d",
        "name": "sleep_before",
        "label": "Delay to stabilize image (s)",
        "tooltip": "Happens before every capture",
        "group": "4322c187.e73e5",
        "order": 4,
        "width": 5,
        "height": 1,
        "wrap": false,
        "passthru": true,
        "topic": "sleep_before",
        "format": "{{value}}",
        "min": "0.1",
        "max": "5",
        "step": "0.1",
        "x": 630,
        "y": 80,
        "wires": [
            [
                "fb887036.12429"
            ]
        ]
    },
    {
        "id": "2911fbc6.d28c24",
        "type": "ui_template",
        "z": "c1660bc.e7ff7f8",
        "group": "c0ebfc57.42527",
        "name": "Image browser",
        "order": 1,
        "width": 24,
        "height": 24,
        "format": "<div>\n    <center>\n        <object data=\"http://planktoscope.local:80/\" width=\"1400px\" height=\"1100px\"></object>\n    </center>\n</div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 600,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "572a6daa.6004c4",
        "type": "link in",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "links": [
            "559a8085.1d6b9"
        ],
        "x": 795,
        "y": 260,
        "wires": [
            [
                "99b11fe4.2795d"
            ]
        ]
    },
    {
        "id": "642ff403.1ed91c",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "sample_concentrated_sample_volume",
        "label": "Concentrated sample volume",
        "tooltip": "Volume extracted from the net",
        "group": "3e1ba03d.f01d8",
        "order": 8,
        "width": 5,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": "1000",
        "topic": "sample_concentrated_sample_volume",
        "x": 590,
        "y": 500,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "e967b844.46aa48",
        "type": "ui_text_input",
        "z": "b771c342.49603",
        "name": "sample_gear_net_opening",
        "label": "Net opening size",
        "tooltip": "in mm",
        "group": "cf5d9f0e.d57e7",
        "order": 1,
        "width": 10,
        "height": 1,
        "passthru": true,
        "mode": "number",
        "delay": "1000",
        "topic": "sample_gear_net_opening",
        "x": 620,
        "y": 620,
        "wires": [
            [
                "9f501f49.45645"
            ]
        ]
    },
    {
        "id": "8032ea50.1b57f",
        "type": "ui_template",
        "z": "baa1e3d9.cb29d",
        "group": "b5d61bc7.54fe48",
        "name": "progress header",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<center><h2>Capture progress</h2></center>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 1610,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "eaf74a43.fa27d",
        "type": "switch",
        "z": "1371dec5.76e671",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "90",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 490,
        "y": 420,
        "wires": [
            [
                "24df077a.cb252"
            ]
        ]
    },
    {
        "id": "46d5e78b.15f998",
        "type": "ui_toast",
        "z": "1371dec5.76e671",
        "position": "dialog",
        "displayTime": "10",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 790,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "24df077a.cb252",
        "type": "change",
        "z": "1371dec5.76e671",
        "name": "full disk msg",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "\"Your drive has reached 90% capacity, you should do a backup to an external drive and a purge.\"",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 420,
        "wires": [
            [
                "46d5e78b.15f998"
            ]
        ]
    },
    {
        "id": "df1ea904.cd261",
        "type": "ui_slider",
        "z": "baa1e3d9.cb29d",
        "name": "imaging_pump_volume",
        "label": "Pumped volume (mL)",
        "tooltip": "inbetween frames",
        "group": "4322c187.e73e5",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "outs": "end",
        "topic": "imaging_pump_volume",
        "min": "0.01",
        "max": "1",
        "step": "0.01",
        "x": 590,
        "y": 320,
        "wires": [
            [
                "fb887036.12429",
                "67091ac0.8f9f6c"
            ]
        ]
    },
    {
        "id": "a4abb1ae.2ae418",
        "type": "subflow:1c24ad9c.bebec2",
        "z": "baa1e3d9.cb29d",
        "name": "",
        "env": [],
        "x": 930,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "752a925a.2d11b4",
        "type": "function",
        "z": "1c24ad9c.bebec2",
        "name": "get global",
        "func": "msg.payload={\n    \"sample_project\":global.get(\"sample_project\"),\n    \"sample_id\":global.get(\"sample_id\"),\n    \"sample_ship\":global.get(\"sample_ship\"),\n    \"sample_operator\":global.get(\"sample_operator\"),\n    \"sample_sampling_gear\":global.get(\"sample_sampling_gear\"),\n    \n    \n    \"acq_id\":global.get(\"acq_id\"),\n    \"acq_instrument\":global.get(\"acq_instrument\"),\n    \"acq_instrument_id\":global.get(\"machine_name\"),\n    \"acq_celltype\":global.get(\"acq_celltype\"),\n    \"acq_minimum_mesh\":global.get(\"acq_minimum_mesh\"),\n    \"acq_maximum_mesh\":global.get(\"acq_maximum_mesh\"),\n    \"acq_min_esd\":global.get(\"acq_min_esd\"),\n    \"acq_max_esd\":global.get(\"acq_max_esd\"),\n    \"acq_magnification\":global.get(\"magnification\"),\n    \"acq_fnumber_objective\":global.get(\"acq_fnumber_objective\"),\n    \"acq_camera\":global.get(\"camera\"),\n    \n    \"object_depth_min\":global.get(\"object_depth_min\"),\n    \"object_depth_max\":global.get(\"object_depth_max\"),\n    \"process_pixel\":global.get(\"process_pixel\"),\n    \"process_id\":global.get(\"process_id\")\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 620,
        "y": 860,
        "wires": [
            [
                "2e6ddf51.c0dba"
            ]
        ]
    },
    {
        "id": "cfc783d7.d6ceb",
        "type": "link in",
        "z": "bccd1f23.87219",
        "name": "Camera Name",
        "links": [
            "559a8085.1d6b9"
        ],
        "x": 1275,
        "y": 180,
        "wires": [
            [
                "8038414a.34461"
            ]
        ]
    },
    {
        "id": "db44a49e.960558",
        "type": "ui_dropdown",
        "z": "b771c342.49603",
        "name": "",
        "label": "Coordinates type",
        "tooltip": "",
        "place": "Coordinates type",
        "group": "3e1ba03d.f01d8",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "DD.DDDD° N (45.543° N)",
                "value": "dd",
                "type": "str"
            },
            {
                "label": "DD°MM.MMMM'N (45°54.534' N)",
                "value": "ddm",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "coordinates_type",
        "x": 590,
        "y": 1020,
        "wires": [
            [
                "8318ab20.aa34f8"
            ]
        ]
    },
    {
        "id": "7953b1b2.d53ed8",
        "type": "function",
        "z": "b771c342.49603",
        "name": "Validate Location",
        "func": "function ConvertDDMMToDD(input) {\n    // Input Format 36°57.4439' N, 110°4.2100' W\n    // From https://stackoverflow.com/questions/1140189/converting-latitude-and-longitude-to-decimal-values\n    var parts = input.split(/[^\\d\\w]+/);\n    var dd = Number(parts[0]) + (Number(parts[1]) + Number(parts[2])/10000)/60;\n    return dd.toFixed(6) + parts[3];\n}\n\nif (flow.get(\"coordinates_type\") == \"ddm\"){\n    msg.payload = ConvertDDMMToDD(msg.payload)\n}\n\n// Input Format 36.574439° N, 110.42100° W\nvar direction = msg.payload.match(/[NSEW]/);\nvar position = msg.payload.match(/[\\+\\-\\d\\.]+/);\n\nif (direction === null)\n{\n    msg.topic = \"Error with the coordinates\"\n    msg.payload = \"You need to explicitely enter N/S/E/W\"\n    return [null, msg];\n}\n\n// Test that position is only made of digits!\nif(! /^\\d+$/.test(position)){\n    msg.topic = \"Error with the coordinates\"\n    msg.payload = \"Use of +/- sign is inconsistent with N/S/E/W letter! Please only use N/S/E/W!\"\n    return [null, msg];\n}\ndd = Number(position)\n\n// Check latitude\nif (direction == \"S\" || direction == \"N\") {\n    if (dd>90.0){\n        msg.topic = \"Error with the coordinates\"\n        msg.payload = \"Latitude is more than 90°\"\n        return [null, msg];\n    }\n}\n\n// Check longitude\nif (direction == \"W\" || direction == \"E\") {\n    if (dd>180.0){\n        msg.topic = \"Error with the coordinates\"\n        msg.payload = \"Longitude is more than 180°\"\n        return [null, msg];\n    }\n}\n\nif (direction == \"S\" || direction == \"W\") {\n    dd = dd * -1;\n} // Don't do anything for N or E\nmsg.payload = dd.toFixed(4);\nreturn [msg, null];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 870,
        "y": 840,
        "wires": [
            [
                "9f501f49.45645"
            ],
            [
                "c0ce5626.b6c5"
            ]
        ],
        "inputLabels": [
            "location"
        ],
        "outputLabels": [
            "checked location",
            "error"
        ]
    },
    {
        "id": "c0ce5626.b6c5",
        "type": "ui_toast",
        "z": "b771c342.49603",
        "position": "dialog",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 1070,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "8318ab20.aa34f8",
        "type": "function",
        "z": "b771c342.49603",
        "name": "set local",
        "func": "flow.set(msg.topic,msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "fc20cd7e.afaab8",
        "type": "inject",
        "z": "b771c342.49603",
        "name": "Default: dd",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "coordinates_type",
        "payload": "dd",
        "payloadType": "str",
        "x": 390,
        "y": 1020,
        "wires": [
            [
                "db44a49e.960558"
            ]
        ]
    },
    {
        "id": "33c28dc1.238002",
        "type": "function",
        "z": "cb95299c.2817c8",
        "name": "reset obj_counter",
        "func": "global.set('obj_counter', 0);\n\nreturn msg;global.set('img_counter', 0);\nglobal.set('obj_counter', 0);\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 300,
        "wires": [
            [
                "16f3cef4.0acac9"
            ]
        ]
    },
    {
        "id": "b9bf06d6.26c518",
        "type": "exec",
        "z": "f21ba04.c26266",
        "command": "sudo iwlist wlan0 scan | grep ESSID | sed 's/ESSID://g;s/\"//g;s/^ *//;s/ *$//'",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "scan",
        "x": 450,
        "y": 80,
        "wires": [
            [
                "9642cb31.663b4"
            ],
            [],
            []
        ]
    },
    {
        "id": "9642cb31.663b4",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "parseOptions",
        "func": "var ssids = msg.payload.split('\\n').filter(s => !!s)\n\nssids = [...new Set(ssids)];\n\nmsg.options = ssids\nmsg.payload = null\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 640,
        "y": 80,
        "wires": [
            [
                "dbc0d44.5361b28"
            ]
        ]
    },
    {
        "id": "3db572cd.cf972e",
        "type": "inject",
        "z": "f21ba04.c26266",
        "name": "once",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 270,
        "y": 180,
        "wires": [
            [
                "b9bf06d6.26c518",
                "4c0400c.69a1e8",
                "448b4c37.be50bc"
            ]
        ]
    },
    {
        "id": "dbc0d44.5361b28",
        "type": "ui_dropdown",
        "z": "f21ba04.c26266",
        "name": "",
        "label": "Wifi",
        "tooltip": "",
        "place": "Select a WIFI",
        "group": "9e409235.73cd7",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [],
        "payload": "",
        "topic": "",
        "x": 830,
        "y": 80,
        "wires": [
            [
                "cdfa9013.b91278"
            ]
        ]
    },
    {
        "id": "2bf338e3.966468",
        "type": "ui_button",
        "z": "f21ba04.c26266",
        "name": "",
        "group": "9e409235.73cd7",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Scan",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-wifi fa-2x",
        "payload": "true",
        "payloadType": "bool",
        "topic": "",
        "x": 270,
        "y": 40,
        "wires": [
            [
                "b9bf06d6.26c518"
            ]
        ]
    },
    {
        "id": "63b885ac.46f384",
        "type": "switch",
        "z": "f21ba04.c26266",
        "name": "ifWifi",
        "property": "name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Wifi",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 271,
        "y": 80,
        "wires": [
            [
                "b9bf06d6.26c518",
                "4c0400c.69a1e8",
                "448b4c37.be50bc"
            ]
        ]
    },
    {
        "id": "4c0400c.69a1e8",
        "type": "exec",
        "z": "f21ba04.c26266",
        "command": "ifconfig wlan0",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "getInfo",
        "x": 460,
        "y": 180,
        "wires": [
            [
                "bcb20e39.00cea8"
            ],
            [],
            []
        ]
    },
    {
        "id": "bcb20e39.00cea8",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "parseInfo",
        "func": "var ip = msg.payload.match(/inet ([0-9\\.]+)/)[1]\nvar mask = msg.payload.match(/netmask ([0-9\\.]+)/)[1]\nvar broadcast = msg.payload.match(/broadcast ([0-9\\.]+)/)[1]\n\n\nnode.send({topic: 'ip', payload: ip})\nnode.send({topic: 'mask', payload: mask})\nnode.send({topic: 'broadcast', payload: broadcast})",
        "outputs": 1,
        "noerr": 0,
        "x": 640,
        "y": 180,
        "wires": [
            [
                "b10ebb83.8214a8"
            ]
        ]
    },
    {
        "id": "b10ebb83.8214a8",
        "type": "switch",
        "z": "f21ba04.c26266",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ip",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "mask",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "broadcast",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 810,
        "y": 181,
        "wires": [
            [
                "d71c8185.800fd"
            ],
            [
                "67d052ba.99ff24"
            ],
            [
                "dc305a26.b33fc"
            ]
        ]
    },
    {
        "id": "d71c8185.800fd",
        "type": "ui_text",
        "z": "f21ba04.c26266",
        "group": "919923a3.d10868",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "IP",
        "format": "{{msg.payload || '---'}}",
        "layout": "row-spread",
        "x": 990,
        "y": 141,
        "wires": []
    },
    {
        "id": "67d052ba.99ff24",
        "type": "ui_text",
        "z": "f21ba04.c26266",
        "group": "919923a3.d10868",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Netmask",
        "format": "{{msg.payload || '---'}}",
        "layout": "row-spread",
        "x": 1000,
        "y": 181,
        "wires": []
    },
    {
        "id": "dc305a26.b33fc",
        "type": "ui_text",
        "z": "f21ba04.c26266",
        "group": "919923a3.d10868",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Broadcast",
        "format": "{{msg.payload || '---'}}",
        "layout": "row-spread",
        "x": 1010,
        "y": 220,
        "wires": []
    },
    {
        "id": "94b2e8fc.aa20e",
        "type": "ui_form",
        "z": "f21ba04.c26266",
        "name": "",
        "label": "Update",
        "group": "9e409235.73cd7",
        "order": 3,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "SSID",
                "value": "ssid",
                "type": "text",
                "required": true,
                "rows": null
            },
            {
                "label": "Password",
                "value": "password",
                "type": "password",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "ssid": "",
            "password": ""
        },
        "payload": "",
        "submit": "UPDATE",
        "cancel": "RESET",
        "topic": "",
        "x": 1160,
        "y": 80,
        "wires": [
            [
                "d59021e3.1b63e8"
            ]
        ]
    },
    {
        "id": "cdfa9013.b91278",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "insert ssid",
        "func": "\nmsg.payload = {ssid: msg.payload}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 990,
        "y": 80,
        "wires": [
            [
                "94b2e8fc.aa20e"
            ]
        ]
    },
    {
        "id": "448b4c37.be50bc",
        "type": "exec",
        "z": "f21ba04.c26266",
        "command": "iwgetid",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "getCurrentSSID",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "151819d4.0dbe56"
            ],
            [],
            []
        ]
    },
    {
        "id": "c8a5ae48.ef1308",
        "type": "ui_text",
        "z": "f21ba04.c26266",
        "group": "919923a3.d10868",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "SSID",
        "format": "{{msg.payload || '---'}}",
        "layout": "row-spread",
        "x": 990,
        "y": 260,
        "wires": []
    },
    {
        "id": "151819d4.0dbe56",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "parseInfo",
        "func": "var ssid = msg.payload.match(/ESSID:\"([^\"]+)\"/)[1]\n\n\nnode.send({topic: 'ssid', payload: ssid})\n",
        "outputs": 1,
        "noerr": 0,
        "x": 720,
        "y": 260,
        "wires": [
            [
                "c8a5ae48.ef1308"
            ]
        ]
    },
    {
        "id": "ff059f3f.9c0f28",
        "type": "ui_ui_control",
        "z": "f21ba04.c26266",
        "name": "onTab",
        "events": "all",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "63b885ac.46f384"
            ]
        ]
    },
    {
        "id": "167d7bd0.679ce4",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "update contry code",
        "func": "var template = `sudo sed -i \\\"s/^country.*/country=\"${msg.payload}\"/\\\" /home/pi/wpa_supplicant.conf`\n// sudo tee /etc/wpa_supplicant/wpa_supplicant.conf <<EOF\n//ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev\n//update_config=1\n//country=IT\nmsg.payload = template\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 630,
        "y": 400,
        "wires": [
            [
                "9d30f7b5.aac88",
                "25c80a31.8bbb3e"
            ]
        ]
    },
    {
        "id": "9d30f7b5.aac88",
        "type": "exec",
        "z": "f21ba04.c26266",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "updateConf",
        "x": 890,
        "y": 400,
        "wires": [
            [
                "25c80a31.8bbb3e"
            ],
            [
                "25c80a31.8bbb3e"
            ],
            []
        ]
    },
    {
        "id": "deb8c14e.ff1fd",
        "type": "ui_button",
        "z": "f21ba04.c26266",
        "name": "",
        "group": "9e409235.73cd7",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Change Country Code",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "country_code",
        "payloadType": "flow",
        "topic": "",
        "x": 400,
        "y": 400,
        "wires": [
            [
                "167d7bd0.679ce4"
            ]
        ]
    },
    {
        "id": "25c80a31.8bbb3e",
        "type": "debug",
        "z": "f21ba04.c26266",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 580,
        "wires": []
    },
    {
        "id": "6d4ce391.04abf4",
        "type": "ui_text_input",
        "z": "f21ba04.c26266",
        "name": "country_code",
        "label": "Country Code",
        "tooltip": "ISO/IEC alpha2 country code",
        "group": "9e409235.73cd7",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "text",
        "delay": "500",
        "topic": "country_code",
        "x": 420,
        "y": 360,
        "wires": [
            [
                "3f60469d.620aea"
            ]
        ]
    },
    {
        "id": "3f60469d.620aea",
        "type": "change",
        "z": "f21ba04.c26266",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "country_code",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "4f02c726.de69b8",
        "type": "ui_button",
        "z": "9daf9e2b.019fc",
        "name": "",
        "group": "1be83144.4fe4bf",
        "order": 10,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Reboot",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "fa-repeat fa-2x",
        "payload": "reboot",
        "payloadType": "str",
        "topic": "reboot",
        "x": 400,
        "y": 420,
        "wires": [
            [
                "4af9112d.87767"
            ]
        ]
    },
    {
        "id": "611a8b1c.a829b4",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "sudo",
        "addpay": true,
        "append": "now",
        "useSpawn": "false",
        "timer": "2",
        "oldrc": false,
        "name": "cmd",
        "x": 870,
        "y": 460,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "bc76c4d6.a7ad28",
        "type": "ui_button",
        "z": "9daf9e2b.019fc",
        "name": "",
        "group": "1be83144.4fe4bf",
        "order": 8,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "Shutdown",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "fa-power-off fa-2x",
        "payload": "shutdown",
        "payloadType": "str",
        "topic": "shutdown",
        "x": 390,
        "y": 500,
        "wires": [
            [
                "4af9112d.87767"
            ]
        ]
    },
    {
        "id": "4af9112d.87767",
        "type": "python3-function",
        "z": "9daf9e2b.019fc",
        "name": "action",
        "func": "#!/usr/bin/python\nimport smbus\n\nbus = smbus.SMBus(1)\n#turn off LED\nbus.write_byte_data(0x0d, 0x07, 0x00)\n#turn off Fan\nbus.write_byte_data(0x0d, 0x08, 0x00)\n\n#msg[\"payload\"] = str(msg[\"topic\"])+' now'\nreturn msg",
        "outputs": 1,
        "x": 690,
        "y": 460,
        "wires": [
            [
                "611a8b1c.a829b4"
            ]
        ]
    },
    {
        "id": "fa914867.0a0658",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "python3 -u /home/pi/PlanktonScope/scripts/main.py",
        "addpay": false,
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "oldrc": false,
        "name": "",
        "x": 1100,
        "y": 340,
        "wires": [
            [],
            [
                "8b511c2b.9c24c8"
            ],
            []
        ]
    },
    {
        "id": "1575db82.742854",
        "type": "delay",
        "z": "9daf9e2b.019fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 700,
        "y": 340,
        "wires": [
            [
                "fa914867.0a0658"
            ]
        ]
    },
    {
        "id": "466eb611.4da048",
        "type": "ui_button",
        "z": "9daf9e2b.019fc",
        "name": "Restart Python",
        "group": "1be83144.4fe4bf",
        "order": 6,
        "width": 4,
        "height": 1,
        "passthru": true,
        "label": "Restart Python",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "fa-refresh fa-2x",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 380,
        "y": 340,
        "wires": [
            [
                "1575db82.742854",
                "bd5cceef.b17ad",
                "ed7503f3.d95a48"
            ]
        ]
    },
    {
        "id": "ed7503f3.d95a48",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "sudo killall -15 python3",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Python soft kill",
        "x": 720,
        "y": 400,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "bd5cceef.b17ad",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "sudo killall -15 raspimjpeg",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Raspimjpeg soft kill",
        "x": 730,
        "y": 280,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "d12008a0.47be4",
        "type": "ui_template",
        "z": "9daf9e2b.019fc",
        "group": "a7d64879.38298",
        "name": "Log table",
        "order": 1,
        "width": 12,
        "height": 10,
        "format": "<script type=\"text/javascript\">\n    function selectElementContents(el) {\n        var body = document.body, range, sel;\n        if (document.createRange && window.getSelection) {\n            range = document.createRange();\n            sel = window.getSelection();\n            sel.removeAllRanges();\n            try {\n                range.selectNodeContents(el);\n                sel.addRange(range);\n            } catch (e) {\n                range.selectNode(el);\n                sel.addRange(range);\n            }\n            document.execCommand(\"copy\");\n            sel.removeAllRanges();\n\n        } else if (body.createTextRange) {\n            range = body.createTextRange();\n            range.moveToElementText(el);\n            range.select();\n            range.execCommand(\"Copy\");\n        }\n    }\n</script>\n\n<md-button onclick=\"selectElementContents( document.getElementById('log_table') );\">\n    <i class=\"fa fa-copy fa-1x\"></i> Copy Log\n</md-button>\n\n<table id=\"log_table\" style=\"font-family: mono;font-size: 5px;\">\n    <tr ng-repeat=\"row in msg.payload\">\n        <td>{{row}}</td>\n    </tr>\n</table>\n\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 1660,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "8b511c2b.9c24c8",
        "type": "function",
        "z": "9daf9e2b.019fc",
        "name": "Log array",
        "func": "var log = context.get(\"python_log\")||[];\n\nlog = log.concat(msg.payload.trim().split('\\n'));\n\nwhile (log.length > 500){\n    log.shift();\n}\n\ncontext.set(\"python_log\", log);\n\nmsg.payload = log;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1480,
        "y": 380,
        "wires": [
            [
                "d12008a0.47be4"
            ]
        ]
    },
    {
        "id": "7a1dedf.1c63094",
        "type": "ui_button",
        "z": "9daf9e2b.019fc",
        "name": "",
        "group": "a7d64879.38298",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Clear Log",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-eraser",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 1320,
        "y": 460,
        "wires": [
            [
                "73500be7.9ab7c4"
            ]
        ]
    },
    {
        "id": "9187bf97.9922b8",
        "type": "catch",
        "z": "9daf9e2b.019fc",
        "name": "Catch Errors",
        "scope": null,
        "uncaught": false,
        "x": 1070,
        "y": 420,
        "wires": [
            [
                "f9a871d5.a73828"
            ]
        ]
    },
    {
        "id": "f9a871d5.a73828",
        "type": "function",
        "z": "9daf9e2b.019fc",
        "name": "Get error",
        "func": "msg.payload = \"Node Red Error: \" + msg.error + \" created by the message \" + msg.payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1240,
        "y": 420,
        "wires": [
            [
                "8b511c2b.9c24c8"
            ]
        ]
    },
    {
        "id": "73500be7.9ab7c4",
        "type": "function",
        "z": "9daf9e2b.019fc",
        "name": "Clear log",
        "func": "context.set(\"python_log\", []);\n\nmsg.payload = [];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1480,
        "y": 460,
        "wires": [
            [
                "d12008a0.47be4"
            ]
        ]
    },
    {
        "id": "7372e83e.5fc0e8",
        "type": "inject",
        "z": "9daf9e2b.019fc",
        "name": "once",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "start",
        "payloadType": "str",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "466eb611.4da048"
            ]
        ]
    },
    {
        "id": "f344dc9e.3c9278",
        "type": "ui_button",
        "z": "1371dec5.76e671",
        "name": "",
        "group": "3ca00bf9.e5cac4",
        "order": 1,
        "width": 4,
        "height": 1,
        "passthru": false,
        "label": "Home",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "home",
        "payload": "{\"tab\":\"Home\"}",
        "payloadType": "json",
        "topic": "",
        "x": 430,
        "y": 740,
        "wires": [
            [
                "5f94b366.e4d3a4"
            ]
        ]
    },
    {
        "id": "5f94b366.e4d3a4",
        "type": "ui_ui_control",
        "z": "1371dec5.76e671",
        "name": "",
        "events": "change",
        "x": 580,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "43cf8ff7.75231",
        "type": "rpi-gpio out",
        "z": "9daf9e2b.019fc",
        "name": "Pump Enable",
        "pin": "7",
        "set": true,
        "level": "1",
        "freq": "",
        "out": "out",
        "x": 420,
        "y": 80,
        "wires": []
    },
    {
        "id": "4bca8a25.15be3c",
        "type": "rpi-gpio out",
        "z": "9daf9e2b.019fc",
        "name": "Focus Enable",
        "pin": "32",
        "set": true,
        "level": "1",
        "freq": "",
        "out": "out",
        "x": 420,
        "y": 120,
        "wires": []
    },
    {
        "id": "50f9b5b.a84bccc",
        "type": "inject",
        "z": "9daf9e2b.019fc",
        "name": "Default: ON",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "0.01",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "43cf8ff7.75231",
                "4bca8a25.15be3c"
            ]
        ]
    },
    {
        "id": "8bd1f3dc.9affe8",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "1",
        "oldrc": false,
        "name": "git user.name",
        "x": 1400,
        "y": 60,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "b40d1f65.39e14",
        "type": "template",
        "z": "9daf9e2b.019fc",
        "name": "git config",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "git config --global --replace-all user.name \"{{payload}}\"",
        "output": "str",
        "x": 1220,
        "y": 60,
        "wires": [
            [
                "8bd1f3dc.9affe8"
            ]
        ]
    },
    {
        "id": "35eb925e.5f8016",
        "type": "link in",
        "z": "9daf9e2b.019fc",
        "name": "Git config",
        "links": [
            "52af9ac0.60eb24"
        ],
        "x": 1035,
        "y": 100,
        "wires": [
            [
                "b40d1f65.39e14",
                "6d7dd372.3b7814"
            ]
        ]
    },
    {
        "id": "4e5183bd.e77bac",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "1",
        "oldrc": false,
        "name": "git user.email",
        "x": 1390,
        "y": 140,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "6d7dd372.3b7814",
        "type": "template",
        "z": "9daf9e2b.019fc",
        "name": "git config",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "git config --global --replace-all user.email \"{{payload}}\"",
        "output": "str",
        "x": 1220,
        "y": 140,
        "wires": [
            [
                "4e5183bd.e77bac"
            ]
        ]
    },
    {
        "id": "e564e9ad.7c312",
        "type": "ui_button",
        "z": "9daf9e2b.019fc",
        "name": "Update",
        "group": "1be83144.4fe4bf",
        "order": 3,
        "width": 6,
        "height": 1,
        "passthru": false,
        "label": "Update",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "mi-system_update",
        "payload": "",
        "payloadType": "str",
        "topic": "update",
        "x": 400,
        "y": 220,
        "wires": [
            [
                "2d2ef1fd.40e6e6"
            ]
        ]
    },
    {
        "id": "2d2ef1fd.40e6e6",
        "type": "exec",
        "z": "9daf9e2b.019fc",
        "command": "bash /home/pi/PlanktonScope/scripts/bash/update.sh",
        "addpay": false,
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "oldrc": false,
        "name": "Update",
        "x": 700,
        "y": 220,
        "wires": [
            [
                "64f61762.68c788",
                "8b511c2b.9c24c8"
            ],
            [
                "64f61762.68c788",
                "8b511c2b.9c24c8"
            ],
            []
        ]
    },
    {
        "id": "8f08c4eb.db74b8",
        "type": "ui_template",
        "z": "9daf9e2b.019fc",
        "group": "1be83144.4fe4bf",
        "name": "Update message",
        "order": 1,
        "width": 12,
        "height": 2,
        "format": "<div><center>If you want to update to the latest code version of Node-Red and Python, please click here.\nWe are trying to save your configuration changes with git stash and restore them afterwards, but clearly, things may break!\nIf you have made changes to the flow, you will lose them. Please commit those changes from Node-Red interface, from the Project History tab.</center></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": true,
        "templateScope": "local",
        "x": 390,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "64f61762.68c788",
        "type": "ui_toast",
        "z": "9daf9e2b.019fc",
        "position": "dialog",
        "displayTime": "10",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "Update notif",
        "x": 970,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "d59021e3.1b63e8",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "add network",
        "func": "var data = msg.payload\n\nvar command = `wpa_passphrase \"${data.ssid}\" \"${data.password}\" | sed '/#psk=\".*\"/d' | sudo tee -a /etc/wpa_supplicant/wpa_supplicant.conf > /dev/null`\n \nmsg.payload = command\n\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1330,
        "y": 80,
        "wires": [
            [
                "64a1f2f2.3de8b4"
            ]
        ]
    },
    {
        "id": "64a1f2f2.3de8b4",
        "type": "exec",
        "z": "f21ba04.c26266",
        "command": "",
        "addpay": true,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "Save Network",
        "x": 1520,
        "y": 80,
        "wires": [
            [
                "6868b4c4.65987c"
            ],
            [],
            []
        ]
    },
    {
        "id": "6868b4c4.65987c",
        "type": "exec",
        "z": "f21ba04.c26266",
        "command": "sudo wpa_cli -i wlan0 reconfigure",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "reconfigure",
        "x": 1710,
        "y": 80,
        "wires": [
            [
                "59e24c40.e1a4dc"
            ],
            [],
            []
        ]
    },
    {
        "id": "59e24c40.e1a4dc",
        "type": "function",
        "z": "f21ba04.c26266",
        "name": "showMessage",
        "func": "\nmsg.payload = msg.payload.trim() === 'OK' ? \"Wifi configuration updated successfully\" : \"Error while updating wifi configuration\"\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1380,
        "y": 240,
        "wires": [
            [
                "4ecb6be2.ad39f4"
            ]
        ]
    },
    {
        "id": "4ecb6be2.ad39f4",
        "type": "ui_toast",
        "z": "f21ba04.c26266",
        "position": "top right",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 1610,
        "y": 240,
        "wires": []
    },
    {
        "id": "f30bf784.90d58",
        "type": "ui_dropdown",
        "z": "1371dec5.76e671",
        "name": "",
        "label": "",
        "tooltip": "",
        "place": "Choose USB device",
        "group": "52d1b77.28369c8",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": false,
        "multiple": false,
        "options": [
            {
                "label": "",
                "value": "No Drive Detected",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "device_path",
        "x": 840,
        "y": 820,
        "wires": [
            [
                "d1b9fed3.f3ead8"
            ]
        ]
    },
    {
        "id": "fe29acc2.c25d18",
        "type": "ui_button",
        "z": "1371dec5.76e671",
        "name": "Detect drive",
        "group": "52d1b77.28369c8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Detect drive",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "fa-usb fa-2x",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 150,
        "y": 820,
        "wires": [
            [
                "4c00cd96.6b2f6c"
            ]
        ]
    },
    {
        "id": "4c00cd96.6b2f6c",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "lsblk --bytes --json --paths --output-all",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "detect drive",
        "x": 330,
        "y": 820,
        "wires": [
            [
                "2dc1e43d.cd3d64"
            ],
            [],
            []
        ]
    },
    {
        "id": "2dc1e43d.cd3d64",
        "type": "json",
        "z": "1371dec5.76e671",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 820,
        "wires": [
            [
                "6b730649.09351"
            ]
        ]
    },
    {
        "id": "6b730649.09351",
        "type": "change",
        "z": "1371dec5.76e671",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "options",
                "pt": "msg",
                "to": "[payload.blockdevices.children[mountpoint=null].name]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 820,
        "wires": [
            [
                "f30bf784.90d58"
            ]
        ]
    },
    {
        "id": "1ece8d8e.1008e2",
        "type": "ui_button",
        "z": "1371dec5.76e671",
        "name": "Backup to USB",
        "group": "52d1b77.28369c8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Backup to USB",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "archive",
        "payload": "",
        "payloadType": "str",
        "topic": "",
        "x": 160,
        "y": 900,
        "wires": [
            [
                "6b2fed77.883c0c"
            ]
        ]
    },
    {
        "id": "d1b9fed3.f3ead8",
        "type": "function",
        "z": "1371dec5.76e671",
        "name": "set local",
        "func": "flow.set(msg.topic,msg.payload);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 1000,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "6b2fed77.883c0c",
        "type": "function",
        "z": "1371dec5.76e671",
        "name": "get device_path",
        "func": "msg.payload = flow.get(\"device_path\");\nreturn msg",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 360,
        "y": 900,
        "wires": [
            [
                "df4d4d6a.24787"
            ]
        ]
    },
    {
        "id": "c74fe76.bcba718",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "sudo /home/pi/PlanktonScope/scripts/bash/usb_backup.sh",
        "addpay": true,
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "oldrc": false,
        "name": "usb_backup.sh",
        "x": 700,
        "y": 920,
        "wires": [
            [
                "72f5e8d4.40fcb8"
            ],
            [],
            [
                "a2c36500.6d376"
            ]
        ]
    },
    {
        "id": "df4d4d6a.24787",
        "type": "switch",
        "z": "1371dec5.76e671",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "No Drive Detected",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 900,
        "wires": [
            [
                "9a577caa.1535a"
            ],
            [
                "c74fe76.bcba718"
            ]
        ]
    },
    {
        "id": "9a577caa.1535a",
        "type": "ui_toast",
        "z": "1371dec5.76e671",
        "position": "dialog",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 690,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "72f5e8d4.40fcb8",
        "type": "ui_toast",
        "z": "1371dec5.76e671",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 910,
        "y": 900,
        "wires": []
    },
    {
        "id": "81a48376.27a66",
        "type": "ui_toast",
        "z": "1371dec5.76e671",
        "position": "dialog",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 1070,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "a2c36500.6d376",
        "type": "function",
        "z": "1371dec5.76e671",
        "name": "error message",
        "func": "switch (msg.payload.code){\ncase 0:\n    msg.payload = \"All files successfully copied, you can remove your usb drive!\";\n    break;\ncase 1:\n    msg.payload = \"There was an error!\";\n    break;\ncase 2:\n    msg.payload = \"Error: your device is already mounted\"\n    break;\ncase 3:\n    msg.payload = \"Error while mounting the device\"\n    break;\ncase 4:\n    msg.payload = \"Error: some files were corrupted during the copy!\"\n    break;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 900,
        "y": 940,
        "wires": [
            [
                "81a48376.27a66"
            ]
        ]
    },
    {
        "id": "dde0025c.3df9f",
        "type": "ui_button",
        "z": "1371dec5.76e671",
        "name": "Purge local",
        "group": "52d1b77.28369c8",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Purge local data",
        "tooltip": "",
        "color": "",
        "bgcolor": "#AD1625",
        "icon": "delete_forever",
        "payload": "THIS IS GOING TO WIPE ALL THE LOCAL DATA. MAKE SURE YOU DID A BACKUP TO AN USB DRIVE BEFOREHAND.",
        "payloadType": "str",
        "topic": "BE EXTRA CAREFUL",
        "x": 150,
        "y": 980,
        "wires": [
            [
                "ba72704a.8a38a"
            ]
        ]
    },
    {
        "id": "ba72704a.8a38a",
        "type": "ui_toast",
        "z": "1371dec5.76e671",
        "position": "dialog",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 1,
        "ok": "GO BACK",
        "cancel": "YES I'M SURE, I WANT TO PURGE THE DATA",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 370,
        "y": 980,
        "wires": [
            [
                "d80e6307.3aaf8"
            ]
        ]
    },
    {
        "id": "b57cc390.f055c8",
        "type": "ui_toast",
        "z": "1371dec5.76e671",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "topic": "",
        "name": "",
        "x": 870,
        "y": 980,
        "wires": []
    },
    {
        "id": "d80e6307.3aaf8",
        "type": "switch",
        "z": "1371dec5.76e671",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "YES I'M SURE",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 530,
        "y": 980,
        "wires": [
            [
                "4a8cb5d4.52e4bc"
            ]
        ]
    },
    {
        "id": "4a8cb5d4.52e4bc",
        "type": "exec",
        "z": "1371dec5.76e671",
        "command": "rm -R /home/pi/data/*",
        "addpay": false,
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "oldrc": false,
        "name": "rm data",
        "x": 680,
        "y": 980,
        "wires": [
            [
                "b57cc390.f055c8"
            ],
            [],
            []
        ]
    }
]